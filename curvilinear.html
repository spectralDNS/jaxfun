<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>curvilinear.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>curvilinear</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/index-DVgeLSg0.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/preload-helper-D2MJg03u.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/clsx-D8GwTfvk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/cn-BKtXLv3a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/react-Bj1aDYRI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/compiler-runtime-B3qBwwSJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/jsx-runtime-ZmTK25f3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/badge-DX6CQ6PA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/hotkeys-BHHWjLlp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useEventListener-Cb-RVVEn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/button-CZ3Cs4qb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/react-dom-CSu739Rf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/Combination-BAEdC-rz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/menu-items-BMjcEb2j.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-DwV58Fb1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/createLucideIcon-BCdY6lG5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/check-Dr3SxUsb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/x-ZP5cObgf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/select-BVdzZKAh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/tooltip-CMQz28hC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/use-toast-BDYuj3zG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_baseIsEqual-B9N9Mw_N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useEvent-BhXAndur.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/invariant-CAG_dYON.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_baseFor-Duhs3RiJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/merge-BBX6ug-N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/zod-H_cgTO0M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/utils-YqBXNpsM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/Deferred-DxQeE5uh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/uuid-DXdzqzcr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/DeferredRequestRegistry-CMf25YiV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/constants-B6Cb__3x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/session-BOFn9QrD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/config-Q0O7_stz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/requests-B4FYHTZl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_hasUnicode-CWqKLxBC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/assertNever-CBU83Y6o.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_arrayReduce-TT0iOGKY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useLifecycle-ClI_npeg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useNonce-CS26E0hA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useTheme-DQozhcp1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/once-Bul8mtFs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/capabilities-MM7JYRxj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/createReducer-B3rBsy4P.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/paths-BzSgteR-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-DxWb3aMV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-NOntBqny.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-CF9gSfGe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-PzrizfuL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-BNkRH34W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-LUpffRIq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-MyTWYTLd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-maX8rbyb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-Bt3KRZho.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/stex-jWatZkll.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/toDate-DETS9bBd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/cjs-CH5Rj0g8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_baseProperty-NKyJO2oh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/now-6sUe0ZdD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/debounce-B3mjKxHe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/toInteger-CDcO32Gx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/database-zap-k4ePIFAU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/main-U5Goe76G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/cells-Botr-aL3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/spinner-DA8-7wQv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/chevron-right--18M_6o9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dropdown-menu-ldcmQvIV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/kbd-Cm6Ba9qg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/renderShortcut-BckyRbYt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/multi-map-DxdLNTBd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/alert-BOoN6gJ1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/card-OlSjYhmd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/alert-dialog-BW4srmS0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dialog-eb-NieZw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dist-CDXJRSCj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/label-E64zk6_7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useDebounce-7iEVSqwM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/textarea-BmPX99zz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/numbers-D7O23mOZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/SSRProvider-BIDQNg9Q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/context-BfYAMNLF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useNumberFormatter-Db6Vjve5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/usePress-C__vuri5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/input-DUrq2DiR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/links-7AQBmdyV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/popover-CH1FzjxU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/switch-Vbll2pdD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/table-DScsXgJW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/mode-C1hn9AVp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useAsyncData-BMGLSTg8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/errors-TZBmrJmc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/error-banner-B9ts0mNl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/copy-DHrHayPa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/memoize-BCOZVFBt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/get-6uJrSKbw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/capitalize-CmNnkG9y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/copy-D-8y6iMN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/plus-B7DF33lD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/refresh-cw-Dx8TEWFP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/trash-2-DDsWrxuJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/triangle-alert-CebQ7XwA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/ai-model-dropdown-BMv5J-EA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/defaultLocale-JieDVWC_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/precisionRound-CU2C3Vxx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/defaultLocale-BLne0bXb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/vega-loader.browser-DXARUlxo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/tooltip-DxKBXCGp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/ErrorBoundary-B9Ifj8Jf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useInstallPackage-D4fX0Ee_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/ImperativeModal-BNN1HA7x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/cell-link-DvW8RUk0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/datasource-acoDY9Ku.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/state-AxOl5_1Q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/MarimoErrorOutput-a6bY4dzO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/copy-icon-v8ME_JKB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/html-to-image-CVa2JapI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/focus--DQRDy9D.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/LazyAnyLanguageCodeMirror-BTO7DS3k.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/chunk-5FQGJX7Z-DPlx2kjA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/katex-CDLTCvjQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/markdown-renderer-DqiLSa6X.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/command-BMidGaii.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/download-COpfLoar.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useRunCells-DrrCdLgV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/purify.es-DZrAQFIu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/RenderHTML-CG3x4AfR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useIframeCapabilities-B_pQb20b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/formats-CobRswjh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/en-US-CCVfmA-q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/isValid-DDt9wNjK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/dates-CrvjILe3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/maps-D2_Mq1pZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/extends-BiFDv3jB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/emotion-is-prop-valid.esm-C59xfSYt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useDateFormatter-CqhdUl2n.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/range-D2UKkEg-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/table-CfDbAm78.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/JsonOutput-ChH_9MPt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useDeleteCell-CRLMdzIa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/icons-CCHmxi8d.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/process-output-uzyiTMlC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/blob-D-eV0cU3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/objectWithoutPropertiesLoose-DfWeGRFv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/esm-BqiVbELQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/file-Ch78NKWp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/play-GLWQQs7F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/add-cell-with-ai-C09q01JF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/isEmpty-CgX_-6Mt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/bot-message-square-B2ThzDUZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/chat-display-DLmJWehR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/chart-no-axes-column-qvVRjhv1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/square-function-B6mgCeFJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/spec-Ch0xnJY4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/column-preview-BZevmZKp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/toggle-zVW4FXNz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/globals-DVVNoYwt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/share-ipf2hrOh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_baseSet-5Rdwpmr3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/react-resizable-panels.browser.esm-Da3ksQXL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/utilities.esm-Di0IV3nO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/floating-outline-CMt2sk--.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useAddCell-DKJ0NHXX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/eye-off-AK_9uodG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/readonly-python-code-Co1fGZLh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/file-video-camera-C3wGzBnE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/types-Dv1-Phf0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/refresh-ccw-DN_xCV6A.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/form-CEIWhPlm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/field-CySaBlkz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useBoolean-Ck_unDZw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/useDeepCompareMemoize-5OUgerQ3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/types-C1UhS3qM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/prop-types-DaaA-ptl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/es-BYgU_srD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/hasIn-CycJImp8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/_baseFlatten-CUZNxU8H.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/flatten-D-7VEN0q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/pick-B_6Qi5aM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/code-xml-CgN_Yig7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/download-Dg7clfkc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/square-CuJ72M8f.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/settings-OBbrbhij.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/bundle.esm-i_UbZC0w.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/cells-jmgGt1lS.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/markdown-renderer-DdDKmWlR.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/JsonOutput-B7vuddcd.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.11/dist/assets/index-CeUwN_0i.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
    window.__MARIMO_STATIC__.modelNotifications = [];
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "curvilinear.py",
            "mode": "read",
            "version": "0.19.11",
            "serverToken": "static",
            "config": {"ai": {"custom_providers": {}, "models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false, "signature_hint_on_typing": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": true, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_csv_encoding": "utf-8", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "mo.md(r\"\"\"\n# Curvilinear coordinates\n\nJaxfun is developed to work with any curvilinear coordinate system and not just the regular Cartesian. A user should describe equations for a generic coordinate system using operators like `div`, `grad`, `dot`, `outer`, `cross` and `curl`. The correct equations in curvilinear coordinates should then be automatically derived by Jaxfun under the hood. What goes on under the hood is described in more detail in this article.\n\nIn the following we will consider two coordinate systems, the Cartesian with coordinates\n\n\\begin{equation}\n    \\mathbf{x} = \\{x^{i}\\}_{i\\in\\mathcal{I}^n},\n\\end{equation}\n\nand the computational, with coordinates\n\n\\begin{equation}\n    \\mathbf{X} = \\{X^{i}\\}_{i\\in\\mathcal{I}^m}.\n\\end{equation}\n\nHere $\\mathcal{I}^m$ and $\\mathcal{I}^n$ are two index sets for the number of computational coordinates, and the dimension of the physical space, respectively, and $m\\leq n$. Throughout this article an index set will be denoted as $\\mathcal{I}^{N}=\\{0, 1, \\ldots, N-1\\}$, where $N\\in \\mathbb{Z}^+$.\n\nThe physical domain will be denoted as $\\Omega^m \\subseteq \\mathbb{R}^n$, where $m=1,2$ and 3 represents curves, surfaces and volumes, respectively. Likewise, the computational domain will be denoted as $\\mathbb{I}^m \\subseteq \\mathbb{R}^m$. The computational domain is a hypercube, with $\\mathbb{I}^2 = \\text{I}^0 \\times \\text{I}^1$ and $\\mathbb{I}^3 = \\text{I}^0 \\times \\text{I}^1 \\times \\text{I}^2$, where $\\text{I}^m$ is the interval used for computational dimension $m$. Hence, computations are always performed on hypercubes.\n\"\"\")", "code_hash": "f49c7ba4d93b509d3f126d226ebdf01c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hbol", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe coordinate curves $X^{i}$ are functions of the Cartesian coordinates\n\n\\begin{equation}\n X^{i} = X^{i}(\\mathbf{x}), \\quad \\text{for } i \\in \\mathcal{I}^m, \\tag{3}\n\\end{equation}\n\nand we get the Cartesian coordinates through the inverse maps\n\n\\begin{equation}\nx^i=x^i(\\mathbf{X}), \\quad \\text{for } i \\in \\mathcal{I}^n.\\tag{4}\n\\end{equation}\n\nUsing these generic maps a function $u : \\Omega^m \\rightarrow \\mathbb{K}$, where $\\mathbb{K}$ may be either $\\mathbb{R}$ or $\\mathbb{C}$, may now be transformed from physicsal to computational space as\n\n\\begin{equation}\nu(\\mathbf{x}) = u(\\mathbf{x}(\\mathbf{X})) = U(\\mathbf{X}(\\mathbf{x})) = U(\\mathbf{X}),\\tag{5}\n\\end{equation}\n\nA simple and well known example is for polar coordinates, where the Cartesian coordinates $x$ and $y$ are mapped to the polar coordinates $r$ and $\\theta$ as\n\n$$\nx(r, \\theta) = r \\cos \\theta \\quad \\text{and} \\quad  y(r, \\theta) = r \\sin \\theta\n$$\n\nA Cartesian function for a circle of radius one is $u(x, y) = \\sqrt{x^2 + y^2} -1$. Inserting for the polar maps we get $u(x(r, \\theta), y(r, \\theta)) = \\sqrt{(r \\cos \\theta)^2 + (r \\sin \\theta)^2} - 1 = r - 1 = U(r, \\theta)$.\n\"\"\")", "code_hash": "2e00544948ea86d9c1e28e6ddf782097", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe transformation for any curvilinear coordinate system will be defined through the use of a position vector, which can be written as a function of the new coordinates\n\n\\begin{equation}\n    \\mathbf{r}(\\mathbf{X}) = x^i(\\mathbf{X}) \\,\\mathbf{i}_i,\\tag{6}\n\\end{equation}\n\nwhere there is here, and throughout this article, summation implied by repeating indices. The Cartesian unit basis vectors are denoted as $\\mathbf{i}_i\\in\\mathbb{R}^n$ for $i\\in \\mathcal{I}^n$. The position vector can describe any point in the physical domain $\\Omega^m$.\n\nA Jacobian matrix for the transformation between coordinate systems is described by\n\n\\begin{equation}\n    J_{ij}(\\mathbf{X}) = \\frac{\\partial x^{i}}{\\partial X^{j}}, \\quad \\text{for } i,j \\in \\mathcal{I}^{n \\times m}, \\tag{7}\n\\end{equation}\n\nwhere the index set  $\\mathcal{I}^{n \\times m} = \\mathcal{I}^m \\times \\mathcal{I}^n$.\n\"\"\")", "code_hash": "9e8d585314c1b7761b88def55fc99f98", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vblA", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe covariant basis vectors are defined as\n\n\\begin{equation}\n    \\mathbf{b}_i(\\mathbf{X}) = \\frac{\\partial \\mathbf{r}}{\\partial X^{i}}, \\quad \\text{for } i \\, \\in \\mathcal{I}^m,\\tag{8}\n\\end{equation}\n\nand contravariant basis vectors are defined as\n\n\\begin{equation}\n    \\mathbf{b}^{i}(\\mathbf{X}) =  \\mathbf{i}_j\\frac{\\partial X^{i}}{\\partial x^j}, \\quad \\text{for } i \\, \\in \\mathcal{I}^m.\\tag{9}\n\\end{equation}\n\nThe co- and contravariant basis vectors satisfy\n\n\\begin{equation}\n    \\mathbf{b}^{i} \\cdot \\mathbf{b}_{j} = \\delta_{j}^{i}, \\quad \\text{for } i, j \\, \\in \\mathcal{I}^{m \\times m}.\\tag{10}\n\\end{equation}\n\nAny vector $\\mathbf{v}$ (boldface lower case letter notation) can be given with either co- or contravariant basis functions and we write them as\n\n\\begin{equation}\n    \\mathbf{v} = {v}^{i} \\mathbf{b}_i = {v}_i \\mathbf{b}^{i},\\tag{11}\n\\end{equation}\n\nwhere ${v}_{i}(\\mathbf{X})$ and ${v}^{i}(\\mathbf{X})$ are co- and contravariant vector components, respectively. The sub or superscript of the coefficient are used to recognise which basis functions are used. The vector can also be given with Cartesian basis vectors, but that is a special case that should be obvious from the context, like for the position vector $\\mathbf{r} =) x^{i}\\mathbf{i}_i$. The Cartesian vectors are thus used with the contravariant vector component notation.\n\nWhen a vector is written with contravariant vector components $\\mathbf{v} = {v}^{i} \\mathbf{b}_i$, the vector is called a contravariant vector. This is the default used by Jaxfun. When the vector is written with covariant components $\\mathbf{v} = {v}_i \\mathbf{b}^{i}$ it is called a covariant vector. This is a bit confusing since a contravariant vector is using covariant basis vectors and vice versa!\n\"\"\")", "code_hash": "b511510cb54cb6613c5c10983cd8cbab", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "mo.md(r\"\"\"\nIn Jaxfun we work by default in the covariant basis with contravariant vector components. However, we can obtain the covariant components ${v}_{i}$ as\n\n$$\n{v}_{i} = {v}^j \\mathbf{b}_j \\cdot \\mathbf{b}_i = {v}^j g_{ji}\n$$\n\nThe co- and contravariant metric tensors are defined as\n\n\\begin{align}\ng_{ij}(\\mathbf{X}) \u0026= \\mathbf{b}_i \\cdot \\mathbf{b}_j \\quad \\text{for } i, j \\in \\mathcal{I}^{m \\times m}, \\tag{12} \\\\\ng^{ij}(\\mathbf{X}) \u0026= \\mathbf{b}^{i} \\cdot \\mathbf{b}^{j} \\quad \\text{for } i, j \\in \\mathcal{I}^{m \\times m}, \\tag{13}\n\\end{align}\n\nrespectively. Finally, the determinant of the covariant metric tensor is given as\n\n\\begin{equation}\n    g(\\mathbf{X}) = \\det([g_{ij}]),\\tag{14}\n\\end{equation}\n\nwhere $[g_{ij}]$ represents the tensor with components $g_{ij}$.\nNote that if $m=n$, then $\\sqrt{g}$ is equal to the determinant of the Jacobian matrix. Also note that if the basis vectors are orthogonal, then $[g_{ij}]$ and $[g^{ij}]$ are diagonal matrices and the co- and contravariant basis vectors  $\\mathbf{b}_{i}$ and $\\mathbf{b}^{i}$ are parallel.\n\nWe can get the contravariant basis vectors from the covariant and vice versa using\n\n$$\n\\begin{align*}\n\\mathbf{b}^{i} \u0026= g^{ij} \\mathbf{b}_{j} \\\\\n\\mathbf{b}_{i} \u0026= g_{ij} \\mathbf{b}^{j}\n\\end{align*}\n$$\n\nThe metric tensors are available in Jaxfun using methods `get_covariant_metric_tensor` and `get_contravariant_metric_tensor` on the given curvilinear coordinate system.\n\"\"\")", "code_hash": "f665154f375ab0bb75234227687c681f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe vector dot product can be defined for curvilinear coordinates as\n\n$$\n\\mathbf{u} \\cdot \\mathbf{v} = {u}^{i}\\mathbf{b}_i \\cdot {v}_j \\mathbf{b}^{j} = {u}^{i} {v}_i\n$$\n\nbecause of Eq. (10).\n\nThe dot product between two vectors both expressed in a covariant basis can be computed as\n\n$$\n{u}^{i}\\mathbf{b}_i \\cdot {v}^{j} \\mathbf{b}_{j} = {u}^{i} {v}^{j} g_{ij}\n$$\n\"\"\")", "code_hash": "6b6712e9bcb2857b8cd749595d134c85", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "PKri", "name": "_"}, {"code": "mo.md(r\"\"\"\nWe will illustrate by creating a cylindrical coordinate system, defined from the position vector\n\n$$\n\\mathbf{r}(r, \\theta, z) = r \\cos \\theta \\mathbf{i} + r \\sin \\theta \\mathbf{j} + z \\mathbf{k}\n$$\n\"\"\")", "code_hash": "895f566f69bb353a7c194fa9f2ecf2ba", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Xref", "name": "_"}, {"code": "from IPython.display import display\nfrom jaxfun.operators import Dot, dot\nfrom jaxfun.coordinates import get_CoordSys\nimport sympy as sp\n\nr, theta, z = sp.symbols(\"r,theta,z\", real=True, positive=True)\nC = get_CoordSys(\n    \"C\", sp.Lambda((r, theta, z), (r * sp.cos(theta), r * sp.sin(theta), z))\n)\nr, theta, z = C.base_scalars()", "code_hash": "48dbf284d383d2d206a71d4f0ba09a53", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SFPL", "name": "_"}, {"code": "mo.md(r\"\"\"\nNote that the curvilinear coordinate system is created from only the forward map $\\mathbf{x}(\\mathbf{X})$ and we do not need to provide the reverse map $\\mathbf{X}(\\mathbf{x})$, which for the cylinder coordinates would be\n\n$$\nr = \\sqrt{x^2+y^2}, \\quad \\theta = \\tan^{-1}(y/x), \\quad z = z.\n$$\n\nThis is because Jaxfun is using the covariant basis vectors computed from the forward map, and the contravariant basis vector may then be computed simply from the $\\mathbf{b}^i = g^{ij} \\mathbf{b}_j$, where $[g^{ij}] = [g_{ij}]^{-1}$. So the reverse map is not explicitly used and as such it does not have to be provided by the user.\n\nNote that on the last line in the code section above we overwrite the sympy symbols `r`, `theta`, `z` with objects of type `BaseScalar`.\n\nAs an example create two contravariant vectors and take the dot product:\n\"\"\")", "code_hash": "6aee19b91e8d5fbf113179bf666dcfff", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "BYtC", "name": "_"}, {"code": "u = 4 * C.b_r + 3 * C.b_theta + 2 * C.b_z\nv = C.b_r\nd = Dot(u, v)\ndisplay(d)\ndisplay(d.doit())", "code_hash": "22ff783809549742ae47d7f5c1166056", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "mo.md(r\"\"\"\nNote that `Dot` represents an unevaluated dot product. It is evaluated by calling `doit()`. Under the hood this invokes the `dot` function. We could alternatively just use the `dot`function:\n\"\"\")", "code_hash": "ba6e83034f46b59382b1280821c1ce48", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Kclp", "name": "_"}, {"code": "dot(u, v)", "code_hash": "2cd2b3194ebc043abafa12027ecea1fc", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe covariant metric tensor is given for cylindrical coordinates as:\n\"\"\")", "code_hash": "83ffc0ea07407270206af0f40ac59da3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hstk", "name": "_"}, {"code": "print(C.get_covariant_metric_tensor())", "code_hash": "99bd5fb4e88b4140a57c2fd49873a2c9", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nWHF", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe metric tensor is diagonal since the cylindrical coordinates are orthogonal.\n\nWe can also create vectors in Cartesian Coordinates and transform them into the curvilinear system. For example\n\"\"\")", "code_hash": "49d420e41b37421e621611134ef5e72d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "iLit", "name": "_"}, {"code": "N = C._parent  # The Cartesian coordinate system\np = N.x * N.i + N.y * N.j + N.z * N.k\ndisplay(p)", "code_hash": "5e73d56669a6205bc0b2b6af47b65993", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(r\"\"\"\nRunning `doit` on this vector transforms the components into computational coordinates, but does not change basis\n\"\"\")", "code_hash": "5269b2af5c6528beeb95d73d8c2c9aa3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ROlb", "name": "_"}, {"code": "display(p.doit())", "code_hash": "7a93332ecf0dd4a7d9f64ddedbe823f2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "mo.md(r\"\"\"\nWe can get this vector $\\mathbf{p}$ in cylinder coordinates by computing\n\n$$\n\\boldsymbol{p} = (\\boldsymbol{p} \\cdot \\boldsymbol{b}_r) \\boldsymbol{b}_r + (\\boldsymbol{p} \\cdot \\boldsymbol{b}_{\\theta}) \\boldsymbol{b}_{\\theta} + (\\boldsymbol{p} \\cdot \\boldsymbol{b}_{z}) \\boldsymbol{b}_{z} = r \\boldsymbol{b}_r + z \\mathbf{b}_z\n$$\n\nThis is called a projection of the vector $\\boldsymbol{p}$ to the cylinder basis. The projection can be computed with method `from_cartesian`:\n\"\"\")", "code_hash": "e30322e47e580090872c62eead6a67a8", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "TqIu", "name": "_"}, {"code": "display(C.from_cartesian(p))", "code_hash": "371903daae1784b7c9be01c142c25f75", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "C.to_cartesian(C.b_theta)", "code_hash": "6238c5652aa6872d150813c2c5559406", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "DnEU", "name": "_"}, {"code": "C.get_contravariant_basis(True)", "code_hash": "3b4cbb00ac1c201f69a9d200616c4145", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "mo.md(r\"\"\"\n### Cross product\n\nThe cross product between two vectors can be obtained as\n\n$$\n\\mathbf{u} \\times \\mathbf{v} = \\varepsilon_{ijk} \\sqrt{g} {u}^j {v}^k \\mathbf{b}^{i} = \\varepsilon_{ijk} \\sqrt{g} {u}^j {v}^k g^{il}\\mathbf{b}_l\n$$\n\"\"\")", "code_hash": "f0010654e6e5e5886cd1b1a02c1983b3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ecfG", "name": "_"}, {"code": "from jaxfun.operators import Cross\n\ncr = Cross(C.b_r, C.b_theta)\ndisplay(cr)\ndisplay(cr.doit())", "code_hash": "fc7e18af96ea088734c3737b93366cdf", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Pvdt", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Dyadics\n\nThe tensor product (or outer product) of two vectors is written\n\n$$\n\\mathbf{A} = \\mathbf{u} \\otimes \\mathbf{v}\n$$\n\nThe second order tensor $\\mathbf{A}$ is called a dyad. There are four possible basis configurations for dyads\n\n$$\n\\begin{align*}\n\\mathbf{b}^{i} \u0026\\otimes \\mathbf{b}^{j} \\\\\n\\mathbf{b}^{i} \u0026\\otimes \\mathbf{b}_{j} \\\\\n\\mathbf{b}_{i} \u0026\\otimes \\mathbf{b}^{j} \\\\\n\\mathbf{b}_{i} \u0026\\otimes \\mathbf{b}_{j} \\\\\n\\end{align*}\n$$\n\nIn Jaxfun we use the last one, with two covariant base vectors $\\mathbf{b}_{i} \\otimes \\mathbf{b}_{j}$. In this case\n\n$$\n\\mathbf{A} = A^{ij} \\mathbf{b}_i \\otimes \\mathbf{b}_j.\n$$\n\nwhere $A^{ij}$ are called the contravariant components.\n\nThe outer product of two vectors is computed as\n\n$$\n\\mathbf{u} \\otimes \\mathbf{v} = {u}^{i} \\mathbf{b}_{i} \\otimes {v}^{j} \\mathbf{b}_{j} = {u}^{i} {v}^{j} \\mathbf{b}_{i} \\otimes \\mathbf{b}_{j}\n$$\n\nDyads are actually defined by how they contract with vectors\n\n$$\n\\begin{align*}\n(\\mathbf{u} \\otimes \\mathbf{v}) \\cdot \\mathbf{w} \u0026= (\\mathbf{v} \\cdot \\mathbf{w}) \\mathbf{u}\\\\\n\\mathbf{w} \\cdot (\\mathbf{u} \\otimes \\mathbf{v}) \u0026= (\\mathbf{w} \\cdot \\mathbf{u}) \\mathbf{v}\n\\end{align*}\n$$\n\nNote that some authors do not use a dot for the contraction of a dyad with a vector and would write instead $(\\mathbf{u} \\otimes \\mathbf{v}) \\mathbf{w}$. Since we use the `Dot/dot` in Jaxfun to represent the contraction of both dyadics and vectors, we find it more appropriate to include the dot also for contraction of higher order tensors.\n\nA linear combination of dyads is called a dyadic. For example $\\mathbf{A} = 2(\\mathbf{u} \\otimes \\mathbf{v}) + 3 (\\mathbf{w} \\otimes \\mathbf{z})$. Note that even though a dyad is a second order tensor, not all second order tensors are dyads. That is, we cannot always write the tensor $\\mathbf{A}$ as the tensor product of two vectors $\\mathbf{u} \\otimes \\mathbf{v}$.\n\nThe contraction of two dyads leads to a dyad\n\n$$\n(\\mathbf{u} \\otimes \\mathbf{v}) \\cdot (\\mathbf{w} \\otimes \\mathbf{z}) = (\\mathbf{v} \\cdot \\mathbf{w}) (\\mathbf{u} \\otimes \\mathbf{z})\n$$\n\nLet create some dyadics in Jaxfun and illustrate. First, the 9 dyad base vectors can be obtained as\n\"\"\")", "code_hash": "57e48423c727ecd3827edb3c9d46f3b6", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZBYS", "name": "_"}, {"code": "bb = C.base_dyadics()\ndisplay(bb)", "code_hash": "8090d28cc1bb329d348385752ee98a9f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}, {"code": "import numpy as np\n\nbv = np.array(bb, dtype=object).reshape((3, 3))\nA = 2 * bv[0, 1] + 3 * bv[1, 2]\nB = r * bv[1, 1] + theta * bv[2, 2]\ndisplay(A)\ndisplay(B)", "code_hash": "265c094d8b7d0c2d132866789933c0b3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nHfw", "name": "_"}, {"code": "mo.md(r\"\"\"\nContract `A` with `B`\n\"\"\")", "code_hash": "c12514b2afbd4cbfddef68807f5dc30f", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "xXTn", "name": "_"}, {"code": "H = Dot(A, B)\ndisplay(H)\ndisplay(H.doit())", "code_hash": "32b6c0273518e0424207cd82b241d1e6", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "AjVT", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Operators in curvilinear coordinates\n\n### Vector operations\n\nThe gradient of a scalar field $f(\\mathbf{x})$ is termed $\\text{grad}(f)$ and equals\n\n\\begin{equation}\n\\text{grad}(f) = \\nabla f = \\frac{\\partial {f}}{\\partial X^{i}}\\,\\mathbf{b}^{i} = \\frac{\\partial {f}}{\\partial X^{i}} g^{ij} \\,\\mathbf{b}_{j}. \\tag{15}\n\\end{equation}\n\nThe divergence of a vector $\\mathbf{v}(\\mathbf{x})$, in terms of its contravariant components, is given as\n\n\\begin{equation}\n\\text{div}(\\mathbf{v}) = \\nabla \\cdot \\mathbf{v} = \\frac{\\partial \\mathbf{v}}{\\partial X^j} \\cdot \\mathbf{b}^j = \\frac{1}{\\sqrt{g}} \\frac{\\partial {v}^{i} \\sqrt{g}}{\\partial X^{i}},\\tag{16}\n\\end{equation}\n\nand the Laplacian of the scalar field $f$ can be written as\n\n\\begin{equation}\n\\text{div}(\\text{grad}(f)) = \\nabla^2 f  = \\frac{1}{\\sqrt{g}}\\frac{\\partial}{\\partial X^{i}}\\left( g^{ij} \\sqrt{g} \\frac{\\partial {f}}{\\partial X^{j}}\\right). \\tag{17}\n\\end{equation}\n\nNote that $g^{ij}$ and $\\sqrt{g}$ will act as variable coefficients when the operators are used in differential equations.\n\nThe curl of a vector is defined as\n\n$$\n\\text{curl}(\\mathbf{v}) = \\nabla \\times \\mathbf{v} = \\mathbf{b}^{j} \\times \\frac{\\partial \\mathbf{v}}{\\partial X^j} = \\frac{\\varepsilon_{ijk}}{\\sqrt{g}} \\frac{\\partial {v}_k}{\\partial X^j} \\mathbf{b}_i\n$$\n\nThe partial derivative $\\frac{\\partial \\mathbf{v}}{\\partial X^j}$ is implemented in Jaxfun as the `diff` operator working on vectors. The partial derivative can be computed as\n\n$$\n\\frac{\\partial \\mathbf{v}}{\\partial X^j} = \\left(\\frac{\\partial {v}^{i}}{\\partial X^j} + \\Gamma^{i}_{kj} {v}^k\\right) \\mathbf{b}_i\n$$\n\nwhere $\\Gamma^{i}_{kj}$ is the Christoffel symbol of the second kind\n\n$$\n\\Gamma^{k}_{ji} = \\frac{\\partial \\mathbf{b}_{i}}{\\partial X^j} \\cdot \\mathbf{b}^k\n$$\n\navailable in Jaxfun as method `get_christoffel_second`.\n\nThe term $\\frac{\\partial {v}^{i}}{\\partial X^j} + \\Gamma^{i}_{kj} {v}^k$ is called the covariant derivative of vector components.\n\nThe Christoffel symbol falls out of the last identity for the curl due to the symmetry $\\Gamma^{k}_{ji} = \\Gamma^k_{ij}$.\n\"\"\")", "code_hash": "99a77e7fd4597b7905f3c1146ba210cd", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pHFh", "name": "_"}, {"code": "mo.md(r\"\"\"\n### Tensor operations\n\nThe gradient of a vector is a second order tensor\n\n$$\n\\text{grad}(\\mathbf{v}) = \\frac{\\partial \\mathbf{v}}{\\partial X^j} \\otimes \\mathbf{b}^j\n$$\n\nNote that if $\\nabla$ is interpreted as a vector, then this corresponds to $(\\nabla \\otimes \\mathbf{v})^T$. However, in Jaxfun printing we interpret $\\nabla$ as an operator and as such $\\text{grad}(\\mathbf{v})$ is printed as $\\nabla \\mathbf{v}$.\n\nThe divergence of a second order tensor $\\mathbf{A}$ is\n\n$$\n\\text{div}(\\mathbf{A}) = \\frac{\\partial \\mathbf{A}}{\\partial X^j} \\cdot \\mathbf{b}^j\n$$\n\nAgain, if $\\nabla$ is interpreted as a vector, then $\\text{div}(\\mathbf{A}) = \\nabla \\cdot \\mathbf{A}^T$. But in Jaxfun's printing $\\nabla$ is an operator acting over the last axis of its input tensor. Hence the divergence of a tensor is printed as $\\nabla \\cdot \\mathbf{A}$.\n\"\"\")", "code_hash": "d47cbe9ed8633bdc93c98e418d7c573f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "NCOB", "name": "_"}, {"code": "from jaxfun.operators import Grad, Div\n\nw = r * C.b_r + theta * C.b_z\ng = Grad(w)\ndisplay(g)\ndisplay(g.doit())", "code_hash": "ba194248230a87df16ef358769845def", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aqbW", "name": "_"}, {"code": "D = r * bv[0, 0] + z * bv[1, 2]\nq = Div(D)\ndisplay(q)\ndisplay(q.doit())", "code_hash": "3225d51f35c363b26bb06bd5c6cafbda", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TRpd", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Curvilinear equations\n\nLets consider the Laplace operator in curvilinear coordinates. For this we use a `ScalarFunction` and Jaxfun operators:\n\"\"\")", "code_hash": "26bdb3f73d6dfc73a244a56191bb420b", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "TXez", "name": "_"}, {"code": "from jaxfun.galerkin.arguments import ScalarFunction\n\nu_ = ScalarFunction(name=\"u\", system=C)\nLu = Div(Grad(u_))\ndisplay(Lu)", "code_hash": "6be3d7142aa0dddb86394625b77babac", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dNNg", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe Laplace operator is displayed in Cartesian coordinates. When evaluated, we get the equation in cylinder coordinates:\n\"\"\")", "code_hash": "d60d420c4d720edc28d5ab0596a1caa2", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "yCnT", "name": "_"}, {"code": "display(Lu.doit())", "code_hash": "13f84c3bf706fa28c78a9706637fd706", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wlCL", "name": "_"}, {"code": "mo.md(r\"\"\"\nNote the map from Cartesian function $u(x, y, z)$ for the generic (unevaluated) operator to computational $U(r, \\theta, z)$ in the evaluated equation.\n\nWe can also look at the gradient\n\"\"\")", "code_hash": "e846967c8a43ab8e646c7a1f45e04afb", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "kqZH", "name": "_"}, {"code": "display(Grad(u_))", "code_hash": "39fb97d982e17affa3c270983acae76e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wAgl", "name": "_"}, {"code": "display(Grad(u_).doit())", "code_hash": "854cc0a0d7d81b3253657b71d4d28656", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "rEll", "name": "_"}, {"code": "mo.md(r\"\"\"\nNote the small difference here from most textbooks that present the gradient as (see, e.g., [wikipedia](https://en.wikipedia.org/wiki/Gradient))\n\n$$\n\\nabla u = \\frac{\\partial U}{\\partial r} \\hat{\\mathbf{b}}_r + \\frac{1}{r}\\frac{\\partial U}{\\partial \\theta} \\hat{\\mathbf{b}}_{\\theta} + \\frac{\\partial U}{\\partial z}\\hat{\\mathbf{b}}_z\n$$\n\nusing normalized (unit) basis vectors $\\hat{\\mathbf{b}}_r = {\\mathbf{b}}_r, \\hat{\\mathbf{b}}_{\\theta} = \\mathbf{b}_{\\theta} / r$ and $\\hat{\\mathbf{b}}_z = \\mathbf{b}_z$. Replacing the hat vectors above with the covariant basis vectors leads to the same result.\n\"\"\")", "code_hash": "be2e5ab71bc39731ea98281632e988eb", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "dGlV", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe curl of a gradient should be zero. Lets verify:\n\"\"\")", "code_hash": "c9b8e8c6dec2a1589c72cc21abd8e084", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SdmI", "name": "_"}, {"code": "from jaxfun.operators import Curl\n\ndisplay(Curl(Grad(u_)))", "code_hash": "d3363ea01c77282a3782f20cd26edeef", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lgWD", "name": "_"}, {"code": "display(C.simplify(Curl(Grad(u_)).doit()))", "code_hash": "c175c984e748bc958a3f5776f1a2a4fd", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "yOPj", "name": "_"}, {"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "fwwy", "name": "_"}], "metadata": {"marimo_version": "0.19.11"}, "version": "1"},
            "session": {"cells": [{"code_hash": "f49c7ba4d93b509d3f126d226ebdf01c", "console": [], "id": "Hbol", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"curvilinear-coordinates\"\u003ECurvilinear coordinates\u003C/h1\u003E\n\u003Cspan class=\"paragraph\"\u003EJaxfun is developed to work with any curvilinear coordinate system and not just the regular Cartesian. A user should describe equations for a generic coordinate system using operators like \u003Ccode\u003Ediv\u003C/code\u003E, \u003Ccode\u003Egrad\u003C/code\u003E, \u003Ccode\u003Edot\u003C/code\u003E, \u003Ccode\u003Eouter\u003C/code\u003E, \u003Ccode\u003Ecross\u003C/code\u003E and \u003Ccode\u003Ecurl\u003C/code\u003E. The correct equations in curvilinear coordinates should then be automatically derived by Jaxfun under the hood. What goes on under the hood is described in more detail in this article.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EIn the following we will consider two coordinate systems, the Cartesian with coordinates\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    \\mathbf{x} = \\{x^{i}\\}_{i\\in\\mathcal{I}^n},\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eand the computational, with coordinates\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    \\mathbf{X} = \\{X^{i}\\}_{i\\in\\mathcal{I}^m}.\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EHere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathcal{I}^m||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathcal{I}^n||)\u003C/marimo-tex\u003E are two index sets for the number of computational coordinates, and the dimension of the physical space, respectively, and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(m\\leq n||)\u003C/marimo-tex\u003E. Throughout this article an index set will be denoted as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathcal{I}^{N}=\\{0, 1, \\ldots, N-1\\}||)\u003C/marimo-tex\u003E, where \u003Cmarimo-tex class=\"arithmatex\"\u003E||(N\\in \\mathbb{Z}^+||)\u003C/marimo-tex\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe physical domain will be denoted as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\Omega^m \\subseteq \\mathbb{R}^n||)\u003C/marimo-tex\u003E, where \u003Cmarimo-tex class=\"arithmatex\"\u003E||(m=1,2||)\u003C/marimo-tex\u003E and 3 represents curves, surfaces and volumes, respectively. Likewise, the computational domain will be denoted as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbb{I}^m \\subseteq \\mathbb{R}^m||)\u003C/marimo-tex\u003E. The computational domain is a hypercube, with \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbb{I}^2 = \\text{I}^0 \\times \\text{I}^1||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbb{I}^3 = \\text{I}^0 \\times \\text{I}^1 \\times \\text{I}^2||)\u003C/marimo-tex\u003E, where \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\text{I}^m||)\u003C/marimo-tex\u003E is the interval used for computational dimension \u003Cmarimo-tex class=\"arithmatex\"\u003E||(m||)\u003C/marimo-tex\u003E. Hence, computations are always performed on hypercubes.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "2e00544948ea86d9c1e28e6ddf782097", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe coordinate curves \u003Cmarimo-tex class=\"arithmatex\"\u003E||(X^{i}||)\u003C/marimo-tex\u003E are functions of the Cartesian coordinates\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n X^{i} = X^{i}(\\mathbf{x}), \\quad \\text{for } i \\in \\mathcal{I}^m, \\tag{3}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eand we get the Cartesian coordinates through the inverse maps\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\nx^i=x^i(\\mathbf{X}), \\quad \\text{for } i \\in \\mathcal{I}^n.\\tag{4}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EUsing these generic maps a function \u003Cmarimo-tex class=\"arithmatex\"\u003E||(u : \\Omega^m \\rightarrow \\mathbb{K}||)\u003C/marimo-tex\u003E, where \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbb{K}||)\u003C/marimo-tex\u003E may be either \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbb{R}||)\u003C/marimo-tex\u003E or \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbb{C}||)\u003C/marimo-tex\u003E, may now be transformed from physicsal to computational space as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\nu(\\mathbf{x}) = u(\\mathbf{x}(\\mathbf{X})) = U(\\mathbf{X}(\\mathbf{x})) = U(\\mathbf{X}),\\tag{5}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EA simple and well known example is for polar coordinates, where the Cartesian coordinates \u003Cmarimo-tex class=\"arithmatex\"\u003E||(x||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(y||)\u003C/marimo-tex\u003E are mapped to the polar coordinates \u003Cmarimo-tex class=\"arithmatex\"\u003E||(r||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\theta||)\u003C/marimo-tex\u003E as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\nx(r, \\theta) = r \\cos \\theta \\quad \\text{and} \\quad  y(r, \\theta) = r \\sin \\theta\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EA Cartesian function for a circle of radius one is \u003Cmarimo-tex class=\"arithmatex\"\u003E||(u(x, y) = \\sqrt{x^2 + y^2} -1||)\u003C/marimo-tex\u003E. Inserting for the polar maps we get \u003Cmarimo-tex class=\"arithmatex\"\u003E||(u(x(r, \\theta), y(r, \\theta)) = \\sqrt{(r \\cos \\theta)^2 + (r \\sin \\theta)^2} - 1 = r - 1 = U(r, \\theta)||)\u003C/marimo-tex\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9e8d585314c1b7761b88def55fc99f98", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe transformation for any curvilinear coordinate system will be defined through the use of a position vector, which can be written as a function of the new coordinates\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    \\mathbf{r}(\\mathbf{X}) = x^i(\\mathbf{X}) \\,\\mathbf{i}_i,\\tag{6}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere there is here, and throughout this article, summation implied by repeating indices. The Cartesian unit basis vectors are denoted as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{i}_i\\in\\mathbb{R}^n||)\u003C/marimo-tex\u003E for \u003Cmarimo-tex class=\"arithmatex\"\u003E||(i\\in \\mathcal{I}^n||)\u003C/marimo-tex\u003E. The position vector can describe any point in the physical domain \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\Omega^m||)\u003C/marimo-tex\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EA Jacobian matrix for the transformation between coordinate systems is described by\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    J_{ij}(\\mathbf{X}) = \\frac{\\partial x^{i}}{\\partial X^{j}}, \\quad \\text{for } i,j \\in \\mathcal{I}^{n \\times m}, \\tag{7}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere the index set  \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathcal{I}^{n \\times m} = \\mathcal{I}^m \\times \\mathcal{I}^n||)\u003C/marimo-tex\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b511510cb54cb6613c5c10983cd8cbab", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe covariant basis vectors are defined as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    \\mathbf{b}_i(\\mathbf{X}) = \\frac{\\partial \\mathbf{r}}{\\partial X^{i}}, \\quad \\text{for } i \\, \\in \\mathcal{I}^m,\\tag{8}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eand contravariant basis vectors are defined as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    \\mathbf{b}^{i}(\\mathbf{X}) =  \\mathbf{i}_j\\frac{\\partial X^{i}}{\\partial x^j}, \\quad \\text{for } i \\, \\in \\mathcal{I}^m.\\tag{9}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe co- and contravariant basis vectors satisfy\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    \\mathbf{b}^{i} \\cdot \\mathbf{b}_{j} = \\delta_{j}^{i}, \\quad \\text{for } i, j \\, \\in \\mathcal{I}^{m \\times m}.\\tag{10}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EAny vector \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{v}||)\u003C/marimo-tex\u003E (boldface lower case letter notation) can be given with either co- or contravariant basis functions and we write them as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    \\mathbf{v} = {v}^{i} \\mathbf{b}_i = {v}_i \\mathbf{b}^{i},\\tag{11}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||({v}_{i}(\\mathbf{X})||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||({v}^{i}(\\mathbf{X})||)\u003C/marimo-tex\u003E are co- and contravariant vector components, respectively. The sub or superscript of the coefficient are used to recognise which basis functions are used. The vector can also be given with Cartesian basis vectors, but that is a special case that should be obvious from the context, like for the position vector \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{r} =) x^{i}\\mathbf{i}_i||)\u003C/marimo-tex\u003E. The Cartesian vectors are thus used with the contravariant vector component notation.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWhen a vector is written with contravariant vector components \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{v} = {v}^{i} \\mathbf{b}_i||)\u003C/marimo-tex\u003E, the vector is called a contravariant vector. This is the default used by Jaxfun. When the vector is written with covariant components \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{v} = {v}_i \\mathbf{b}^{i}||)\u003C/marimo-tex\u003E it is called a covariant vector. This is a bit confusing since a contravariant vector is using covariant basis vectors and vice versa!\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f665154f375ab0bb75234227687c681f", "console": [], "id": "lEQa", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EIn Jaxfun we work by default in the covariant basis with contravariant vector components. However, we can obtain the covariant components \u003Cmarimo-tex class=\"arithmatex\"\u003E||({v}_{i}||)\u003C/marimo-tex\u003E as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n{v}_{i} = {v}^j \\mathbf{b}_j \\cdot \\mathbf{b}_i = {v}^j g_{ji}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe co- and contravariant metric tensors are defined as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{align}\ng_{ij}(\\mathbf{X}) \u0026amp;= \\mathbf{b}_i \\cdot \\mathbf{b}_j \\quad \\text{for } i, j \\in \\mathcal{I}^{m \\times m}, \\tag{12} \\\\\ng^{ij}(\\mathbf{X}) \u0026amp;= \\mathbf{b}^{i} \\cdot \\mathbf{b}^{j} \\quad \\text{for } i, j \\in \\mathcal{I}^{m \\times m}, \\tag{13}\n\\end{align}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Erespectively. Finally, the determinant of the covariant metric tensor is given as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n    g(\\mathbf{X}) = \\det([g_{ij}]),\\tag{14}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||([g_{ij}]||)\u003C/marimo-tex\u003E represents the tensor with components \u003Cmarimo-tex class=\"arithmatex\"\u003E||(g_{ij}||)\u003C/marimo-tex\u003E.\nNote that if \u003Cmarimo-tex class=\"arithmatex\"\u003E||(m=n||)\u003C/marimo-tex\u003E, then \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\sqrt{g}||)\u003C/marimo-tex\u003E is equal to the determinant of the Jacobian matrix. Also note that if the basis vectors are orthogonal, then \u003Cmarimo-tex class=\"arithmatex\"\u003E||([g_{ij}]||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||([g^{ij}]||)\u003C/marimo-tex\u003E are diagonal matrices and the co- and contravariant basis vectors  \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{b}_{i}||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{b}^{i}||)\u003C/marimo-tex\u003E are parallel.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe can get the contravariant basis vectors from the covariant and vice versa using\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\begin{align*}\n\\mathbf{b}^{i} \u0026amp;= g^{ij} \\mathbf{b}_{j} \\\\\n\\mathbf{b}_{i} \u0026amp;= g_{ij} \\mathbf{b}^{j}\n\\end{align*}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe metric tensors are available in Jaxfun using methods \u003Ccode\u003Eget_covariant_metric_tensor\u003C/code\u003E and \u003Ccode\u003Eget_contravariant_metric_tensor\u003C/code\u003E on the given curvilinear coordinate system.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "6b6712e9bcb2857b8cd749595d134c85", "console": [], "id": "PKri", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe vector dot product can be defined for curvilinear coordinates as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\mathbf{u} \\cdot \\mathbf{v} = {u}^{i}\\mathbf{b}_i \\cdot {v}_j \\mathbf{b}^{j} = {u}^{i} {v}_i\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ebecause of Eq. (10).\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe dot product between two vectors both expressed in a covariant basis can be computed as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n{u}^{i}\\mathbf{b}_i \\cdot {v}^{j} \\mathbf{b}_{j} = {u}^{i} {v}^{j} g_{ij}\n||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "895f566f69bb353a7c194fa9f2ecf2ba", "console": [], "id": "Xref", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWe will illustrate by creating a cylindrical coordinate system, defined from the position vector\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\mathbf{r}(r, \\theta, z) = r \\cos \\theta \\mathbf{i} + r \\sin \\theta \\mathbf{j} + z \\mathbf{k}\n||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "48dbf284d383d2d206a71d4f0ba09a53", "console": [], "id": "SFPL", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "6aee19b91e8d5fbf113179bf666dcfff", "console": [], "id": "BYtC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENote that the curvilinear coordinate system is created from only the forward map \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{x}(\\mathbf{X})||)\u003C/marimo-tex\u003E and we do not need to provide the reverse map \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{X}(\\mathbf{x})||)\u003C/marimo-tex\u003E, which for the cylinder coordinates would be\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\nr = \\sqrt{x^2+y^2}, \\quad \\theta = \\tan^{-1}(y/x), \\quad z = z.\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThis is because Jaxfun is using the covariant basis vectors computed from the forward map, and the contravariant basis vector may then be computed simply from the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{b}^i = g^{ij} \\mathbf{b}_j||)\u003C/marimo-tex\u003E, where \u003Cmarimo-tex class=\"arithmatex\"\u003E||([g^{ij}] = [g_{ij}]^{-1}||)\u003C/marimo-tex\u003E. So the reverse map is not explicitly used and as such it does not have to be provided by the user.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ENote that on the last line in the code section above we overwrite the sympy symbols \u003Ccode\u003Er\u003C/code\u003E, \u003Ccode\u003Etheta\u003C/code\u003E, \u003Ccode\u003Ez\u003C/code\u003E with objects of type \u003Ccode\u003EBaseScalar\u003C/code\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EAs an example create two contravariant vectors and take the dot product:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "22ff783809549742ae47d7f5c1166056", "console": [], "id": "RGSE", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(\\left(4\\right)\\mathbf{b_{r}} + \\left(3\\right)\\mathbf{b_{\\theta}} + \\left(2\\right)\\mathbf{b_{z}}\\right) \\cdot \\mathbf{b_{r}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[4||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "ba6e83034f46b59382b1280821c1ce48", "console": [], "id": "Kclp", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENote that \u003Ccode\u003EDot\u003C/code\u003E represents an unevaluated dot product. It is evaluated by calling \u003Ccode\u003Edoit()\u003C/code\u003E. Under the hood this invokes the \u003Ccode\u003Edot\u003C/code\u003E function. We could alternatively just use the \u003Ccode\u003Edot\u003C/code\u003Efunction:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "2cd2b3194ebc043abafa12027ecea1fc", "console": [], "id": "emfo", "outputs": [{"data": {"text/html": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[4||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "83ffc0ea07407270206af0f40ac59da3", "console": [], "id": "Hstk", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe covariant metric tensor is given for cylindrical coordinates as:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "99bd5fb4e88b4140a57c2fd49873a2c9", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[[1 0 0]\n [0 r**2 0]\n [0 0 1]]\n", "type": "stream"}], "id": "nWHF", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "49d420e41b37421e621611134ef5e72d", "console": [], "id": "iLit", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe metric tensor is diagonal since the cylindrical coordinates are orthogonal.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe can also create vectors in Cartesian Coordinates and transform them into the curvilinear system. For example\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5e73d56669a6205bc0b2b6af47b65993", "console": [], "id": "ZHCJ", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(x\\right)\\mathbf{{i}} + \\left(y\\right)\\mathbf{{j}} + \\left(z\\right)\\mathbf{{k}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "5269b2af5c6528beeb95d73d8c2c9aa3", "console": [], "id": "ROlb", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ERunning \u003Ccode\u003Edoit\u003C/code\u003E on this vector transforms the components into computational coordinates, but does not change basis\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7a93332ecf0dd4a7d9f64ddedbe823f2", "console": [], "id": "qnkX", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(r \\cos{\\left(\\theta \\right)}\\right)\\mathbf{{i}} + \\left(r \\sin{\\left(\\theta \\right)}\\right)\\mathbf{{j}} + \\left(z\\right)\\mathbf{{k}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "e30322e47e580090872c62eead6a67a8", "console": [], "id": "TqIu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWe can get this vector \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{p}||)\u003C/marimo-tex\u003E in cylinder coordinates by computing\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\boldsymbol{p} = (\\boldsymbol{p} \\cdot \\boldsymbol{b}_r) \\boldsymbol{b}_r + (\\boldsymbol{p} \\cdot \\boldsymbol{b}_{\\theta}) \\boldsymbol{b}_{\\theta} + (\\boldsymbol{p} \\cdot \\boldsymbol{b}_{z}) \\boldsymbol{b}_{z} = r \\boldsymbol{b}_r + z \\mathbf{b}_z\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThis is called a projection of the vector \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\boldsymbol{p}||)\u003C/marimo-tex\u003E to the cylinder basis. The projection can be computed with method \u003Ccode\u003Efrom_cartesian\u003C/code\u003E:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "371903daae1784b7c9be01c142c25f75", "console": [], "id": "Vxnm", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(r\\right)\\mathbf{b_{r}} + \\left(z\\right)\\mathbf{b_{z}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "6238c5652aa6872d150813c2c5559406", "console": [], "id": "DnEU", "outputs": [{"data": {"text/html": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(- r \\sin{\\left(\\theta \\right)}\\right)\\mathbf{{i}} + \\left(r \\cos{\\left(\\theta \\right)}\\right)\\mathbf{{j}}||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "3b4cbb00ac1c201f69a9d200616c4145", "console": [], "id": "ulZA", "outputs": [{"data": {"text/html": "\u003Cpre class='text-xs'\u003Earray([(cos(theta))*R.i + (sin(theta))*R.j,\n       (-sin(theta)/r)*R.i + (cos(theta)/r)*R.j, R.k], dtype=object)\u003C/pre\u003E"}, "type": "data"}]}, {"code_hash": "f0010654e6e5e5886cd1b1a02c1983b3", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"cross-product\"\u003ECross product\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003EThe cross product between two vectors can be obtained as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\mathbf{u} \\times \\mathbf{v} = \\varepsilon_{ijk} \\sqrt{g} {u}^j {v}^k \\mathbf{b}^{i} = \\varepsilon_{ijk} \\sqrt{g} {u}^j {v}^k g^{il}\\mathbf{b}_l\n||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "fc7e18af96ea088734c3737b93366cdf", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\mathbf{b_{r}} \\times \\mathbf{b_{\\theta}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(r\\right)\\mathbf{b_{z}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "57e48423c727ecd3827edb3c9d46f3b6", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"dyadics\"\u003EDyadics\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThe tensor product (or outer product) of two vectors is written\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\mathbf{A} = \\mathbf{u} \\otimes \\mathbf{v}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe second order tensor \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{A}||)\u003C/marimo-tex\u003E is called a dyad. There are four possible basis configurations for dyads\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\begin{align*}\n\\mathbf{b}^{i} \u0026amp;\\otimes \\mathbf{b}^{j} \\\\\n\\mathbf{b}^{i} \u0026amp;\\otimes \\mathbf{b}_{j} \\\\\n\\mathbf{b}_{i} \u0026amp;\\otimes \\mathbf{b}^{j} \\\\\n\\mathbf{b}_{i} \u0026amp;\\otimes \\mathbf{b}_{j} \\\\\n\\end{align*}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EIn Jaxfun we use the last one, with two covariant base vectors \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{b}_{i} \\otimes \\mathbf{b}_{j}||)\u003C/marimo-tex\u003E. In this case\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\mathbf{A} = A^{ij} \\mathbf{b}_i \\otimes \\mathbf{b}_j.\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(A^{ij}||)\u003C/marimo-tex\u003E are called the contravariant components.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe outer product of two vectors is computed as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\mathbf{u} \\otimes \\mathbf{v} = {u}^{i} \\mathbf{b}_{i} \\otimes {v}^{j} \\mathbf{b}_{j} = {u}^{i} {v}^{j} \\mathbf{b}_{i} \\otimes \\mathbf{b}_{j}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EDyads are actually defined by how they contract with vectors\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\begin{align*}\n(\\mathbf{u} \\otimes \\mathbf{v}) \\cdot \\mathbf{w} \u0026amp;= (\\mathbf{v} \\cdot \\mathbf{w}) \\mathbf{u}\\\\\n\\mathbf{w} \\cdot (\\mathbf{u} \\otimes \\mathbf{v}) \u0026amp;= (\\mathbf{w} \\cdot \\mathbf{u}) \\mathbf{v}\n\\end{align*}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003ENote that some authors do not use a dot for the contraction of a dyad with a vector and would write instead \u003Cmarimo-tex class=\"arithmatex\"\u003E||((\\mathbf{u} \\otimes \\mathbf{v}) \\mathbf{w}||)\u003C/marimo-tex\u003E. Since we use the \u003Ccode\u003EDot/dot\u003C/code\u003E in Jaxfun to represent the contraction of both dyadics and vectors, we find it more appropriate to include the dot also for contraction of higher order tensors.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EA linear combination of dyads is called a dyadic. For example \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{A} = 2(\\mathbf{u} \\otimes \\mathbf{v}) + 3 (\\mathbf{w} \\otimes \\mathbf{z})||)\u003C/marimo-tex\u003E. Note that even though a dyad is a second order tensor, not all second order tensors are dyads. That is, we cannot always write the tensor \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{A}||)\u003C/marimo-tex\u003E as the tensor product of two vectors \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{u} \\otimes \\mathbf{v}||)\u003C/marimo-tex\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe contraction of two dyads leads to a dyad\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n(\\mathbf{u} \\otimes \\mathbf{v}) \\cdot (\\mathbf{w} \\otimes \\mathbf{z}) = (\\mathbf{v} \\cdot \\mathbf{w}) (\\mathbf{u} \\otimes \\mathbf{z})\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003ELet create some dyadics in Jaxfun and illustrate. First, the 9 dyad base vectors can be obtained as\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8090d28cc1bb329d348385752ee98a9f", "console": [], "id": "aLJB", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left( \\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{r}}\\right), \\  \\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{\\theta}}\\right), \\  \\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{z}}\\right), \\  \\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{r}}\\right), \\  \\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{\\theta}}\\right), \\  \\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{z}}\\right), \\  \\left(\\mathbf{b_{z}}\u2297\\mathbf{b_{r}}\\right), \\  \\left(\\mathbf{b_{z}}\u2297\\mathbf{b_{\\theta}}\\right), \\  \\left(\\mathbf{b_{z}}\u2297\\mathbf{b_{z}}\\right)\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "265c094d8b7d0c2d132866789933c0b3", "console": [], "id": "nHfw", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(2\\right)\\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{\\theta}}\\right) + \\left(3\\right)\\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{z}}\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(r\\right)\\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{\\theta}}\\right) + \\left(\\theta\\right)\\left(\\mathbf{b_{z}}\u2297\\mathbf{b_{z}}\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "c12514b2afbd4cbfddef68807f5dc30f", "console": [], "id": "xXTn", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EContract \u003Ccode\u003EA\u003C/code\u003E with \u003Ccode\u003EB\u003C/code\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "32b6c0273518e0424207cd82b241d1e6", "console": [], "id": "AjVT", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(\\left(2\\right)\\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{\\theta}}\\right) + \\left(3\\right)\\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{z}}\\right)\\right) \\cdot \\left(\\left(r\\right)\\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{\\theta}}\\right) + \\left(\\theta\\right)\\left(\\mathbf{b_{z}}\u2297\\mathbf{b_{z}}\\right)\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(2 r^{3}\\right)\\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{\\theta}}\\right) + \\left(3 \\theta\\right)\\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{z}}\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "99a77e7fd4597b7905f3c1146ba210cd", "console": [], "id": "pHFh", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"operators-in-curvilinear-coordinates\"\u003EOperators in curvilinear coordinates\u003C/h2\u003E\n\u003Ch3 id=\"vector-operations\"\u003EVector operations\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003EThe gradient of a scalar field \u003Cmarimo-tex class=\"arithmatex\"\u003E||(f(\\mathbf{x})||)\u003C/marimo-tex\u003E is termed \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\text{grad}(f)||)\u003C/marimo-tex\u003E and equals\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n\\text{grad}(f) = \\nabla f = \\frac{\\partial {f}}{\\partial X^{i}}\\,\\mathbf{b}^{i} = \\frac{\\partial {f}}{\\partial X^{i}} g^{ij} \\,\\mathbf{b}_{j}. \\tag{15}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe divergence of a vector \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{v}(\\mathbf{x})||)\u003C/marimo-tex\u003E, in terms of its contravariant components, is given as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n\\text{div}(\\mathbf{v}) = \\nabla \\cdot \\mathbf{v} = \\frac{\\partial \\mathbf{v}}{\\partial X^j} \\cdot \\mathbf{b}^j = \\frac{1}{\\sqrt{g}} \\frac{\\partial {v}^{i} \\sqrt{g}}{\\partial X^{i}},\\tag{16}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eand the Laplacian of the scalar field \u003Cmarimo-tex class=\"arithmatex\"\u003E||(f||)\u003C/marimo-tex\u003E can be written as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\begin{equation}\n\\text{div}(\\text{grad}(f)) = \\nabla^2 f  = \\frac{1}{\\sqrt{g}}\\frac{\\partial}{\\partial X^{i}}\\left( g^{ij} \\sqrt{g} \\frac{\\partial {f}}{\\partial X^{j}}\\right). \\tag{17}\n\\end{equation}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003ENote that \u003Cmarimo-tex class=\"arithmatex\"\u003E||(g^{ij}||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\sqrt{g}||)\u003C/marimo-tex\u003E will act as variable coefficients when the operators are used in differential equations.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe curl of a vector is defined as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\text{curl}(\\mathbf{v}) = \\nabla \\times \\mathbf{v} = \\mathbf{b}^{j} \\times \\frac{\\partial \\mathbf{v}}{\\partial X^j} = \\frac{\\varepsilon_{ijk}}{\\sqrt{g}} \\frac{\\partial {v}_k}{\\partial X^j} \\mathbf{b}_i\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EThe partial derivative \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial \\mathbf{v}}{\\partial X^j}||)\u003C/marimo-tex\u003E is implemented in Jaxfun as the \u003Ccode\u003Ediff\u003C/code\u003E operator working on vectors. The partial derivative can be computed as\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\frac{\\partial \\mathbf{v}}{\\partial X^j} = \\left(\\frac{\\partial {v}^{i}}{\\partial X^j} + \\Gamma^{i}_{kj} {v}^k\\right) \\mathbf{b}_i\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\Gamma^{i}_{kj}||)\u003C/marimo-tex\u003E is the Christoffel symbol of the second kind\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\Gamma^{k}_{ji} = \\frac{\\partial \\mathbf{b}_{i}}{\\partial X^j} \\cdot \\mathbf{b}^k\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eavailable in Jaxfun as method \u003Ccode\u003Eget_christoffel_second\u003C/code\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe term \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\frac{\\partial {v}^{i}}{\\partial X^j} + \\Gamma^{i}_{kj} {v}^k||)\u003C/marimo-tex\u003E is called the covariant derivative of vector components.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe Christoffel symbol falls out of the last identity for the curl due to the symmetry \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\Gamma^{k}_{ji} = \\Gamma^k_{ij}||)\u003C/marimo-tex\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d47cbe9ed8633bdc93c98e418d7c573f", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"tensor-operations\"\u003ETensor operations\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003EThe gradient of a vector is a second order tensor\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\text{grad}(\\mathbf{v}) = \\frac{\\partial \\mathbf{v}}{\\partial X^j} \\otimes \\mathbf{b}^j\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003ENote that if \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\nabla||)\u003C/marimo-tex\u003E is interpreted as a vector, then this corresponds to \u003Cmarimo-tex class=\"arithmatex\"\u003E||((\\nabla \\otimes \\mathbf{v})^T||)\u003C/marimo-tex\u003E. However, in Jaxfun printing we interpret \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\nabla||)\u003C/marimo-tex\u003E as an operator and as such \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\text{grad}(\\mathbf{v})||)\u003C/marimo-tex\u003E is printed as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\nabla \\mathbf{v}||)\u003C/marimo-tex\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe divergence of a second order tensor \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{A}||)\u003C/marimo-tex\u003E is\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\text{div}(\\mathbf{A}) = \\frac{\\partial \\mathbf{A}}{\\partial X^j} \\cdot \\mathbf{b}^j\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EAgain, if \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\nabla||)\u003C/marimo-tex\u003E is interpreted as a vector, then \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\text{div}(\\mathbf{A}) = \\nabla \\cdot \\mathbf{A}^T||)\u003C/marimo-tex\u003E. But in Jaxfun's printing \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\nabla||)\u003C/marimo-tex\u003E is an operator acting over the last axis of its input tensor. Hence the divergence of a tensor is printed as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\nabla \\cdot \\mathbf{A}||)\u003C/marimo-tex\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ba194248230a87df16ef358769845def", "console": [], "id": "aqbW", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\displaystyle \\nabla \\left(\\left(r\\right)\\mathbf{b_{r}} + \\left(\\theta\\right)\\mathbf{b_{z}}\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{r}}\\right) + \\left(\\frac{1}{r^{2}}\\right)\\left(\\mathbf{b_{z}}\u2297\\mathbf{b_{\\theta}}\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "3225d51f35c363b26bb06bd5c6cafbda", "console": [], "id": "TRpd", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\nabla\\cdot \\left(\\left(r\\right)\\left(\\mathbf{b_{r}}\u2297\\mathbf{b_{r}}\\right) + \\left(z\\right)\\left(\\mathbf{b_{\\theta}}\u2297\\mathbf{b_{z}}\\right)\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\mathbf{b_{r}} + \\mathbf{b_{\\theta}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "26bdb3f73d6dfc73a244a56191bb420b", "console": [], "id": "TXez", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"curvilinear-equations\"\u003ECurvilinear equations\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ELets consider the Laplace operator in curvilinear coordinates. For this we use a \u003Ccode\u003EScalarFunction\u003C/code\u003E and Jaxfun operators:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "6be3d7142aa0dddb86394625b77babac", "console": [], "id": "dNNg", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\nabla\\cdot \\displaystyle \\nabla \\left(u(x, y, z)\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "d60d420c4d720edc28d5ab0596a1caa2", "console": [], "id": "yCnT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe Laplace operator is displayed in Cartesian coordinates. When evaluated, we get the equation in cylinder coordinates:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "13f84c3bf706fa28c78a9706637fd706", "console": [], "id": "wlCL", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\frac{\\partial^{2}}{\\partial r^{2}} U{\\left(r,\\theta,z \\right)} + \\frac{\\partial^{2}}{\\partial z^{2}} U{\\left(r,\\theta,z \\right)} + \\frac{\\frac{\\partial}{\\partial r} U{\\left(r,\\theta,z \\right)}}{r} + \\frac{\\frac{\\partial^{2}}{\\partial \\theta^{2}} U{\\left(r,\\theta,z \\right)}}{r^{2}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "e846967c8a43ab8e646c7a1f45e04afb", "console": [], "id": "kqZH", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENote the map from Cartesian function \u003Cmarimo-tex class=\"arithmatex\"\u003E||(u(x, y, z)||)\u003C/marimo-tex\u003E for the generic (unevaluated) operator to computational \u003Cmarimo-tex class=\"arithmatex\"\u003E||(U(r, \\theta, z)||)\u003C/marimo-tex\u003E in the evaluated equation.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe can also look at the gradient\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "39fb97d982e17affa3c270983acae76e", "console": [], "id": "wAgl", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\displaystyle \\nabla \\left(u(x, y, z)\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "854cc0a0d7d81b3253657b71d4d28656", "console": [], "id": "rEll", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\left(\\frac{\\partial}{\\partial r} U{\\left(r,\\theta,z \\right)}\\right)\\mathbf{b_{r}} + \\left(\\frac{\\frac{\\partial}{\\partial \\theta} U{\\left(r,\\theta,z \\right)}}{r^{2}}\\right)\\mathbf{b_{\\theta}} + \\left(\\frac{\\partial}{\\partial z} U{\\left(r,\\theta,z \\right)}\\right)\\mathbf{b_{z}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "be2e5ab71bc39731ea98281632e988eb", "console": [], "id": "dGlV", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENote the small difference here from most textbooks that present the gradient as (see, e.g., \u003Ca href=\"https://en.wikipedia.org/wiki/Gradient\" rel=\"noopener noreferrer\" target=\"_blank\"\u003Ewikipedia\u003C/a\u003E)\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\nabla u = \\frac{\\partial U}{\\partial r} \\hat{\\mathbf{b}}_r + \\frac{1}{r}\\frac{\\partial U}{\\partial \\theta} \\hat{\\mathbf{b}}_{\\theta} + \\frac{\\partial U}{\\partial z}\\hat{\\mathbf{b}}_z\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eusing normalized (unit) basis vectors \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\hat{\\mathbf{b}}_r = {\\mathbf{b}}_r, \\hat{\\mathbf{b}}_{\\theta} = \\mathbf{b}_{\\theta} / r||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\hat{\\mathbf{b}}_z = \\mathbf{b}_z||)\u003C/marimo-tex\u003E. Replacing the hat vectors above with the covariant basis vectors leads to the same result.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c9b8e8c6dec2a1589c72cc21abd8e084", "console": [], "id": "SdmI", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe curl of a gradient should be zero. Lets verify:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d3363ea01c77282a3782f20cd26edeef", "console": [], "id": "lgWD", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\nabla\\times \\displaystyle \\nabla \\left(u(x, y, z)\\right)||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "c175c984e748bc958a3f5776f1a2a4fd", "console": [], "id": "yOPj", "outputs": [{"data": {"text/html": "\u003Cdiv style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'\u003E\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\mathbf{\\hat{0}}||]\u003C/marimo-tex\u003E\u003C/span\u003E\u003C/div\u003E"}, "type": "data"}]}, {"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "fwwy", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}], "metadata": {"marimo_version": "0.19.11"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.19.11%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Curvilinear%20coordinates%0A%0A%20%20%20%20Jaxfun%20is%20developed%20to%20work%20with%20any%20curvilinear%20coordinate%20system%20and%20not%20just%20the%20regular%20Cartesian.%20A%20user%20should%20describe%20equations%20for%20a%20generic%20coordinate%20system%20using%20operators%20like%20%60div%60%2C%20%60grad%60%2C%20%60dot%60%2C%20%60outer%60%2C%20%60cross%60%20and%20%60curl%60.%20The%20correct%20equations%20in%20curvilinear%20coordinates%20should%20then%20be%20automatically%20derived%20by%20Jaxfun%20under%20the%20hood.%20What%20goes%20on%20under%20the%20hood%20is%20described%20in%20more%20detail%20in%20this%20article.%0A%0A%20%20%20%20In%20the%20following%20we%20will%20consider%20two%20coordinate%20systems%2C%20the%20Cartesian%20with%20coordinates%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cmathbf%7Bx%7D%20%3D%20%5C%7Bx%5E%7Bi%7D%5C%7D_%7Bi%5Cin%5Cmathcal%7BI%7D%5En%7D%2C%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20and%20the%20computational%2C%20with%20coordinates%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cmathbf%7BX%7D%20%3D%20%5C%7BX%5E%7Bi%7D%5C%7D_%7Bi%5Cin%5Cmathcal%7BI%7D%5Em%7D.%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20Here%20%24%5Cmathcal%7BI%7D%5Em%24%20and%20%24%5Cmathcal%7BI%7D%5En%24%20are%20two%20index%20sets%20for%20the%20number%20of%20computational%20coordinates%2C%20and%20the%20dimension%20of%20the%20physical%20space%2C%20respectively%2C%20and%20%24m%5Cleq%20n%24.%20Throughout%20this%20article%20an%20index%20set%20will%20be%20denoted%20as%20%24%5Cmathcal%7BI%7D%5E%7BN%7D%3D%5C%7B0%2C%201%2C%20%5Cldots%2C%20N-1%5C%7D%24%2C%20where%20%24N%5Cin%20%5Cmathbb%7BZ%7D%5E%2B%24.%0A%0A%20%20%20%20The%20physical%20domain%20will%20be%20denoted%20as%20%24%5COmega%5Em%20%5Csubseteq%20%5Cmathbb%7BR%7D%5En%24%2C%20where%20%24m%3D1%2C2%24%20and%203%20represents%20curves%2C%20surfaces%20and%20volumes%2C%20respectively.%20Likewise%2C%20the%20computational%20domain%20will%20be%20denoted%20as%20%24%5Cmathbb%7BI%7D%5Em%20%5Csubseteq%20%5Cmathbb%7BR%7D%5Em%24.%20The%20computational%20domain%20is%20a%20hypercube%2C%20with%20%24%5Cmathbb%7BI%7D%5E2%20%3D%20%5Ctext%7BI%7D%5E0%20%5Ctimes%20%5Ctext%7BI%7D%5E1%24%20and%20%24%5Cmathbb%7BI%7D%5E3%20%3D%20%5Ctext%7BI%7D%5E0%20%5Ctimes%20%5Ctext%7BI%7D%5E1%20%5Ctimes%20%5Ctext%7BI%7D%5E2%24%2C%20where%20%24%5Ctext%7BI%7D%5Em%24%20is%20the%20interval%20used%20for%20computational%20dimension%20%24m%24.%20Hence%2C%20computations%20are%20always%20performed%20on%20hypercubes.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20coordinate%20curves%20%24X%5E%7Bi%7D%24%20are%20functions%20of%20the%20Cartesian%20coordinates%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20X%5E%7Bi%7D%20%3D%20X%5E%7Bi%7D(%5Cmathbf%7Bx%7D)%2C%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%20%5Cin%20%5Cmathcal%7BI%7D%5Em%2C%20%5Ctag%7B3%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20and%20we%20get%20the%20Cartesian%20coordinates%20through%20the%20inverse%20maps%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20x%5Ei%3Dx%5Ei(%5Cmathbf%7BX%7D)%2C%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%20%5Cin%20%5Cmathcal%7BI%7D%5En.%5Ctag%7B4%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20Using%20these%20generic%20maps%20a%20function%20%24u%20%3A%20%5COmega%5Em%20%5Crightarrow%20%5Cmathbb%7BK%7D%24%2C%20where%20%24%5Cmathbb%7BK%7D%24%20may%20be%20either%20%24%5Cmathbb%7BR%7D%24%20or%20%24%5Cmathbb%7BC%7D%24%2C%20may%20now%20be%20transformed%20from%20physicsal%20to%20computational%20space%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20u(%5Cmathbf%7Bx%7D)%20%3D%20u(%5Cmathbf%7Bx%7D(%5Cmathbf%7BX%7D))%20%3D%20U(%5Cmathbf%7BX%7D(%5Cmathbf%7Bx%7D))%20%3D%20U(%5Cmathbf%7BX%7D)%2C%5Ctag%7B5%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20A%20simple%20and%20well%20known%20example%20is%20for%20polar%20coordinates%2C%20where%20the%20Cartesian%20coordinates%20%24x%24%20and%20%24y%24%20are%20mapped%20to%20the%20polar%20coordinates%20%24r%24%20and%20%24%5Ctheta%24%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20x(r%2C%20%5Ctheta)%20%3D%20r%20%5Ccos%20%5Ctheta%20%5Cquad%20%5Ctext%7Band%7D%20%5Cquad%20%20y(r%2C%20%5Ctheta)%20%3D%20r%20%5Csin%20%5Ctheta%0A%20%20%20%20%24%24%0A%0A%20%20%20%20A%20Cartesian%20function%20for%20a%20circle%20of%20radius%20one%20is%20%24u(x%2C%20y)%20%3D%20%5Csqrt%7Bx%5E2%20%2B%20y%5E2%7D%20-1%24.%20Inserting%20for%20the%20polar%20maps%20we%20get%20%24u(x(r%2C%20%5Ctheta)%2C%20y(r%2C%20%5Ctheta))%20%3D%20%5Csqrt%7B(r%20%5Ccos%20%5Ctheta)%5E2%20%2B%20(r%20%5Csin%20%5Ctheta)%5E2%7D%20-%201%20%3D%20r%20-%201%20%3D%20U(r%2C%20%5Ctheta)%24.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20transformation%20for%20any%20curvilinear%20coordinate%20system%20will%20be%20defined%20through%20the%20use%20of%20a%20position%20vector%2C%20which%20can%20be%20written%20as%20a%20function%20of%20the%20new%20coordinates%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cmathbf%7Br%7D(%5Cmathbf%7BX%7D)%20%3D%20x%5Ei(%5Cmathbf%7BX%7D)%20%5C%2C%5Cmathbf%7Bi%7D_i%2C%5Ctag%7B6%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20where%20there%20is%20here%2C%20and%20throughout%20this%20article%2C%20summation%20implied%20by%20repeating%20indices.%20The%20Cartesian%20unit%20basis%20vectors%20are%20denoted%20as%20%24%5Cmathbf%7Bi%7D_i%5Cin%5Cmathbb%7BR%7D%5En%24%20for%20%24i%5Cin%20%5Cmathcal%7BI%7D%5En%24.%20The%20position%20vector%20can%20describe%20any%20point%20in%20the%20physical%20domain%20%24%5COmega%5Em%24.%0A%0A%20%20%20%20A%20Jacobian%20matrix%20for%20the%20transformation%20between%20coordinate%20systems%20is%20described%20by%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20J_%7Bij%7D(%5Cmathbf%7BX%7D)%20%3D%20%5Cfrac%7B%5Cpartial%20x%5E%7Bi%7D%7D%7B%5Cpartial%20X%5E%7Bj%7D%7D%2C%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%2Cj%20%5Cin%20%5Cmathcal%7BI%7D%5E%7Bn%20%5Ctimes%20m%7D%2C%20%5Ctag%7B7%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20where%20the%20index%20set%20%20%24%5Cmathcal%7BI%7D%5E%7Bn%20%5Ctimes%20m%7D%20%3D%20%5Cmathcal%7BI%7D%5Em%20%5Ctimes%20%5Cmathcal%7BI%7D%5En%24.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20covariant%20basis%20vectors%20are%20defined%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cmathbf%7Bb%7D_i(%5Cmathbf%7BX%7D)%20%3D%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7Br%7D%7D%7B%5Cpartial%20X%5E%7Bi%7D%7D%2C%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%20%5C%2C%20%5Cin%20%5Cmathcal%7BI%7D%5Em%2C%5Ctag%7B8%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20and%20contravariant%20basis%20vectors%20are%20defined%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cmathbf%7Bb%7D%5E%7Bi%7D(%5Cmathbf%7BX%7D)%20%3D%20%20%5Cmathbf%7Bi%7D_j%5Cfrac%7B%5Cpartial%20X%5E%7Bi%7D%7D%7B%5Cpartial%20x%5Ej%7D%2C%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%20%5C%2C%20%5Cin%20%5Cmathcal%7BI%7D%5Em.%5Ctag%7B9%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20The%20co-%20and%20contravariant%20basis%20vectors%20satisfy%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%20%5Ccdot%20%5Cmathbf%7Bb%7D_%7Bj%7D%20%3D%20%5Cdelta_%7Bj%7D%5E%7Bi%7D%2C%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%2C%20j%20%5C%2C%20%5Cin%20%5Cmathcal%7BI%7D%5E%7Bm%20%5Ctimes%20m%7D.%5Ctag%7B10%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20Any%20vector%20%24%5Cmathbf%7Bv%7D%24%20(boldface%20lower%20case%20letter%20notation)%20can%20be%20given%20with%20either%20co-%20or%20contravariant%20basis%20functions%20and%20we%20write%20them%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20%5Cmathbf%7Bv%7D%20%3D%20%7Bv%7D%5E%7Bi%7D%20%5Cmathbf%7Bb%7D_i%20%3D%20%7Bv%7D_i%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%2C%5Ctag%7B11%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20where%20%24%7Bv%7D_%7Bi%7D(%5Cmathbf%7BX%7D)%24%20and%20%24%7Bv%7D%5E%7Bi%7D(%5Cmathbf%7BX%7D)%24%20are%20co-%20and%20contravariant%20vector%20components%2C%20respectively.%20The%20sub%20or%20superscript%20of%20the%20coefficient%20are%20used%20to%20recognise%20which%20basis%20functions%20are%20used.%20The%20vector%20can%20also%20be%20given%20with%20Cartesian%20basis%20vectors%2C%20but%20that%20is%20a%20special%20case%20that%20should%20be%20obvious%20from%20the%20context%2C%20like%20for%20the%20position%20vector%20%24%5Cmathbf%7Br%7D%20%3D)%20x%5E%7Bi%7D%5Cmathbf%7Bi%7D_i%24.%20The%20Cartesian%20vectors%20are%20thus%20used%20with%20the%20contravariant%20vector%20component%20notation.%0A%0A%20%20%20%20When%20a%20vector%20is%20written%20with%20contravariant%20vector%20components%20%24%5Cmathbf%7Bv%7D%20%3D%20%7Bv%7D%5E%7Bi%7D%20%5Cmathbf%7Bb%7D_i%24%2C%20the%20vector%20is%20called%20a%20contravariant%20vector.%20This%20is%20the%20default%20used%20by%20Jaxfun.%20When%20the%20vector%20is%20written%20with%20covariant%20components%20%24%5Cmathbf%7Bv%7D%20%3D%20%7Bv%7D_i%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%24%20it%20is%20called%20a%20covariant%20vector.%20This%20is%20a%20bit%20confusing%20since%20a%20contravariant%20vector%20is%20using%20covariant%20basis%20vectors%20and%20vice%20versa!%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20In%20Jaxfun%20we%20work%20by%20default%20in%20the%20covariant%20basis%20with%20contravariant%20vector%20components.%20However%2C%20we%20can%20obtain%20the%20covariant%20components%20%24%7Bv%7D_%7Bi%7D%24%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%7Bv%7D_%7Bi%7D%20%3D%20%7Bv%7D%5Ej%20%5Cmathbf%7Bb%7D_j%20%5Ccdot%20%5Cmathbf%7Bb%7D_i%20%3D%20%7Bv%7D%5Ej%20g_%7Bji%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20The%20co-%20and%20contravariant%20metric%20tensors%20are%20defined%20as%0A%0A%20%20%20%20%5Cbegin%7Balign%7D%0A%20%20%20%20g_%7Bij%7D(%5Cmathbf%7BX%7D)%20%26%3D%20%5Cmathbf%7Bb%7D_i%20%5Ccdot%20%5Cmathbf%7Bb%7D_j%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%2C%20j%20%5Cin%20%5Cmathcal%7BI%7D%5E%7Bm%20%5Ctimes%20m%7D%2C%20%5Ctag%7B12%7D%20%5C%5C%0A%20%20%20%20g%5E%7Bij%7D(%5Cmathbf%7BX%7D)%20%26%3D%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%20%5Ccdot%20%5Cmathbf%7Bb%7D%5E%7Bj%7D%20%5Cquad%20%5Ctext%7Bfor%20%7D%20i%2C%20j%20%5Cin%20%5Cmathcal%7BI%7D%5E%7Bm%20%5Ctimes%20m%7D%2C%20%5Ctag%7B13%7D%0A%20%20%20%20%5Cend%7Balign%7D%0A%0A%20%20%20%20respectively.%20Finally%2C%20the%20determinant%20of%20the%20covariant%20metric%20tensor%20is%20given%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%20%20%20%20g(%5Cmathbf%7BX%7D)%20%3D%20%5Cdet(%5Bg_%7Bij%7D%5D)%2C%5Ctag%7B14%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20where%20%24%5Bg_%7Bij%7D%5D%24%20represents%20the%20tensor%20with%20components%20%24g_%7Bij%7D%24.%0A%20%20%20%20Note%20that%20if%20%24m%3Dn%24%2C%20then%20%24%5Csqrt%7Bg%7D%24%20is%20equal%20to%20the%20determinant%20of%20the%20Jacobian%20matrix.%20Also%20note%20that%20if%20the%20basis%20vectors%20are%20orthogonal%2C%20then%20%24%5Bg_%7Bij%7D%5D%24%20and%20%24%5Bg%5E%7Bij%7D%5D%24%20are%20diagonal%20matrices%20and%20the%20co-%20and%20contravariant%20basis%20vectors%20%20%24%5Cmathbf%7Bb%7D_%7Bi%7D%24%20and%20%24%5Cmathbf%7Bb%7D%5E%7Bi%7D%24%20are%20parallel.%0A%0A%20%20%20%20We%20can%20get%20the%20contravariant%20basis%20vectors%20from%20the%20covariant%20and%20vice%20versa%20using%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%20%26%3D%20g%5E%7Bij%7D%20%5Cmathbf%7Bb%7D_%7Bj%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7Bb%7D_%7Bi%7D%20%26%3D%20g_%7Bij%7D%20%5Cmathbf%7Bb%7D%5E%7Bj%7D%0A%20%20%20%20%5Cend%7Balign*%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20The%20metric%20tensors%20are%20available%20in%20Jaxfun%20using%20methods%20%60get_covariant_metric_tensor%60%20and%20%60get_contravariant_metric_tensor%60%20on%20the%20given%20curvilinear%20coordinate%20system.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20vector%20dot%20product%20can%20be%20defined%20for%20curvilinear%20coordinates%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmathbf%7Bu%7D%20%5Ccdot%20%5Cmathbf%7Bv%7D%20%3D%20%7Bu%7D%5E%7Bi%7D%5Cmathbf%7Bb%7D_i%20%5Ccdot%20%7Bv%7D_j%20%5Cmathbf%7Bb%7D%5E%7Bj%7D%20%3D%20%7Bu%7D%5E%7Bi%7D%20%7Bv%7D_i%0A%20%20%20%20%24%24%0A%0A%20%20%20%20because%20of%20Eq.%20(10).%0A%0A%20%20%20%20The%20dot%20product%20between%20two%20vectors%20both%20expressed%20in%20a%20covariant%20basis%20can%20be%20computed%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%7Bu%7D%5E%7Bi%7D%5Cmathbf%7Bb%7D_i%20%5Ccdot%20%7Bv%7D%5E%7Bj%7D%20%5Cmathbf%7Bb%7D_%7Bj%7D%20%3D%20%7Bu%7D%5E%7Bi%7D%20%7Bv%7D%5E%7Bj%7D%20g_%7Bij%7D%0A%20%20%20%20%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20We%20will%20illustrate%20by%20creating%20a%20cylindrical%20coordinate%20system%2C%20defined%20from%20the%20position%20vector%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmathbf%7Br%7D(r%2C%20%5Ctheta%2C%20z)%20%3D%20r%20%5Ccos%20%5Ctheta%20%5Cmathbf%7Bi%7D%20%2B%20r%20%5Csin%20%5Ctheta%20%5Cmathbf%7Bj%7D%20%2B%20z%20%5Cmathbf%7Bk%7D%0A%20%20%20%20%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20from%20IPython.display%20import%20display%0A%20%20%20%20from%20jaxfun.operators%20import%20Dot%2C%20dot%0A%20%20%20%20from%20jaxfun.coordinates%20import%20get_CoordSys%0A%20%20%20%20import%20sympy%20as%20sp%0A%0A%20%20%20%20r%2C%20theta%2C%20z%20%3D%20sp.symbols(%22r%2Ctheta%2Cz%22%2C%20real%3DTrue%2C%20positive%3DTrue)%0A%20%20%20%20C%20%3D%20get_CoordSys(%0A%20%20%20%20%20%20%20%20%22C%22%2C%20sp.Lambda((r%2C%20theta%2C%20z)%2C%20(r%20*%20sp.cos(theta)%2C%20r%20*%20sp.sin(theta)%2C%20z))%0A%20%20%20%20)%0A%20%20%20%20r%2C%20theta%2C%20z%20%3D%20C.base_scalars()%0A%20%20%20%20return%20C%2C%20Dot%2C%20display%2C%20dot%2C%20r%2C%20theta%2C%20z%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Note%20that%20the%20curvilinear%20coordinate%20system%20is%20created%20from%20only%20the%20forward%20map%20%24%5Cmathbf%7Bx%7D(%5Cmathbf%7BX%7D)%24%20and%20we%20do%20not%20need%20to%20provide%20the%20reverse%20map%20%24%5Cmathbf%7BX%7D(%5Cmathbf%7Bx%7D)%24%2C%20which%20for%20the%20cylinder%20coordinates%20would%20be%0A%0A%20%20%20%20%24%24%0A%20%20%20%20r%20%3D%20%5Csqrt%7Bx%5E2%2By%5E2%7D%2C%20%5Cquad%20%5Ctheta%20%3D%20%5Ctan%5E%7B-1%7D(y%2Fx)%2C%20%5Cquad%20z%20%3D%20z.%0A%20%20%20%20%24%24%0A%0A%20%20%20%20This%20is%20because%20Jaxfun%20is%20using%20the%20covariant%20basis%20vectors%20computed%20from%20the%20forward%20map%2C%20and%20the%20contravariant%20basis%20vector%20may%20then%20be%20computed%20simply%20from%20the%20%24%5Cmathbf%7Bb%7D%5Ei%20%3D%20g%5E%7Bij%7D%20%5Cmathbf%7Bb%7D_j%24%2C%20where%20%24%5Bg%5E%7Bij%7D%5D%20%3D%20%5Bg_%7Bij%7D%5D%5E%7B-1%7D%24.%20So%20the%20reverse%20map%20is%20not%20explicitly%20used%20and%20as%20such%20it%20does%20not%20have%20to%20be%20provided%20by%20the%20user.%0A%0A%20%20%20%20Note%20that%20on%20the%20last%20line%20in%20the%20code%20section%20above%20we%20overwrite%20the%20sympy%20symbols%20%60r%60%2C%20%60theta%60%2C%20%60z%60%20with%20objects%20of%20type%20%60BaseScalar%60.%0A%0A%20%20%20%20As%20an%20example%20create%20two%20contravariant%20vectors%20and%20take%20the%20dot%20product%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20Dot%2C%20display)%3A%0A%20%20%20%20u%20%3D%204%20*%20C.b_r%20%2B%203%20*%20C.b_theta%20%2B%202%20*%20C.b_z%0A%20%20%20%20v%20%3D%20C.b_r%0A%20%20%20%20d%20%3D%20Dot(u%2C%20v)%0A%20%20%20%20display(d)%0A%20%20%20%20display(d.doit())%0A%20%20%20%20return%20u%2C%20v%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Note%20that%20%60Dot%60%20represents%20an%20unevaluated%20dot%20product.%20It%20is%20evaluated%20by%20calling%20%60doit()%60.%20Under%20the%20hood%20this%20invokes%20the%20%60dot%60%20function.%20We%20could%20alternatively%20just%20use%20the%20%60dot%60function%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(dot%2C%20u%2C%20v)%3A%0A%20%20%20%20dot(u%2C%20v)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20covariant%20metric%20tensor%20is%20given%20for%20cylindrical%20coordinates%20as%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C)%3A%0A%20%20%20%20print(C.get_covariant_metric_tensor())%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20metric%20tensor%20is%20diagonal%20since%20the%20cylindrical%20coordinates%20are%20orthogonal.%0A%0A%20%20%20%20We%20can%20also%20create%20vectors%20in%20Cartesian%20Coordinates%20and%20transform%20them%20into%20the%20curvilinear%20system.%20For%20example%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20display)%3A%0A%20%20%20%20N%20%3D%20C._parent%20%20%23%20The%20Cartesian%20coordinate%20system%0A%20%20%20%20p%20%3D%20N.x%20*%20N.i%20%2B%20N.y%20*%20N.j%20%2B%20N.z%20*%20N.k%0A%20%20%20%20display(p)%0A%20%20%20%20return%20(p%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Running%20%60doit%60%20on%20this%20vector%20transforms%20the%20components%20into%20computational%20coordinates%2C%20but%20does%20not%20change%20basis%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(display%2C%20p)%3A%0A%20%20%20%20display(p.doit())%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20We%20can%20get%20this%20vector%20%24%5Cmathbf%7Bp%7D%24%20in%20cylinder%20coordinates%20by%20computing%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cboldsymbol%7Bp%7D%20%3D%20(%5Cboldsymbol%7Bp%7D%20%5Ccdot%20%5Cboldsymbol%7Bb%7D_r)%20%5Cboldsymbol%7Bb%7D_r%20%2B%20(%5Cboldsymbol%7Bp%7D%20%5Ccdot%20%5Cboldsymbol%7Bb%7D_%7B%5Ctheta%7D)%20%5Cboldsymbol%7Bb%7D_%7B%5Ctheta%7D%20%2B%20(%5Cboldsymbol%7Bp%7D%20%5Ccdot%20%5Cboldsymbol%7Bb%7D_%7Bz%7D)%20%5Cboldsymbol%7Bb%7D_%7Bz%7D%20%3D%20r%20%5Cboldsymbol%7Bb%7D_r%20%2B%20z%20%5Cmathbf%7Bb%7D_z%0A%20%20%20%20%24%24%0A%0A%20%20%20%20This%20is%20called%20a%20projection%20of%20the%20vector%20%24%5Cboldsymbol%7Bp%7D%24%20to%20the%20cylinder%20basis.%20The%20projection%20can%20be%20computed%20with%20method%20%60from_cartesian%60%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20display%2C%20p)%3A%0A%20%20%20%20display(C.from_cartesian(p))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C)%3A%0A%20%20%20%20C.to_cartesian(C.b_theta)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C)%3A%0A%20%20%20%20C.get_contravariant_basis(True)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Cross%20product%0A%0A%20%20%20%20The%20cross%20product%20between%20two%20vectors%20can%20be%20obtained%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmathbf%7Bu%7D%20%5Ctimes%20%5Cmathbf%7Bv%7D%20%3D%20%5Cvarepsilon_%7Bijk%7D%20%5Csqrt%7Bg%7D%20%7Bu%7D%5Ej%20%7Bv%7D%5Ek%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%20%3D%20%5Cvarepsilon_%7Bijk%7D%20%5Csqrt%7Bg%7D%20%7Bu%7D%5Ej%20%7Bv%7D%5Ek%20g%5E%7Bil%7D%5Cmathbf%7Bb%7D_l%0A%20%20%20%20%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20display)%3A%0A%20%20%20%20from%20jaxfun.operators%20import%20Cross%0A%0A%20%20%20%20cr%20%3D%20Cross(C.b_r%2C%20C.b_theta)%0A%20%20%20%20display(cr)%0A%20%20%20%20display(cr.doit())%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Dyadics%0A%0A%20%20%20%20The%20tensor%20product%20(or%20outer%20product)%20of%20two%20vectors%20is%20written%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmathbf%7BA%7D%20%3D%20%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20The%20second%20order%20tensor%20%24%5Cmathbf%7BA%7D%24%20is%20called%20a%20dyad.%20There%20are%20four%20possible%20basis%20configurations%20for%20dyads%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%20%26%5Cotimes%20%5Cmathbf%7Bb%7D%5E%7Bj%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7Bb%7D%5E%7Bi%7D%20%26%5Cotimes%20%5Cmathbf%7Bb%7D_%7Bj%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7Bb%7D_%7Bi%7D%20%26%5Cotimes%20%5Cmathbf%7Bb%7D%5E%7Bj%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7Bb%7D_%7Bi%7D%20%26%5Cotimes%20%5Cmathbf%7Bb%7D_%7Bj%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Balign*%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20In%20Jaxfun%20we%20use%20the%20last%20one%2C%20with%20two%20covariant%20base%20vectors%20%24%5Cmathbf%7Bb%7D_%7Bi%7D%20%5Cotimes%20%5Cmathbf%7Bb%7D_%7Bj%7D%24.%20In%20this%20case%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmathbf%7BA%7D%20%3D%20A%5E%7Bij%7D%20%5Cmathbf%7Bb%7D_i%20%5Cotimes%20%5Cmathbf%7Bb%7D_j.%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24A%5E%7Bij%7D%24%20are%20called%20the%20contravariant%20components.%0A%0A%20%20%20%20The%20outer%20product%20of%20two%20vectors%20is%20computed%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D%20%3D%20%7Bu%7D%5E%7Bi%7D%20%5Cmathbf%7Bb%7D_%7Bi%7D%20%5Cotimes%20%7Bv%7D%5E%7Bj%7D%20%5Cmathbf%7Bb%7D_%7Bj%7D%20%3D%20%7Bu%7D%5E%7Bi%7D%20%7Bv%7D%5E%7Bj%7D%20%5Cmathbf%7Bb%7D_%7Bi%7D%20%5Cotimes%20%5Cmathbf%7Bb%7D_%7Bj%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20Dyads%20are%20actually%20defined%20by%20how%20they%20contract%20with%20vectors%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20(%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D)%20%5Ccdot%20%5Cmathbf%7Bw%7D%20%26%3D%20(%5Cmathbf%7Bv%7D%20%5Ccdot%20%5Cmathbf%7Bw%7D)%20%5Cmathbf%7Bu%7D%5C%5C%0A%20%20%20%20%5Cmathbf%7Bw%7D%20%5Ccdot%20(%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D)%20%26%3D%20(%5Cmathbf%7Bw%7D%20%5Ccdot%20%5Cmathbf%7Bu%7D)%20%5Cmathbf%7Bv%7D%0A%20%20%20%20%5Cend%7Balign*%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20Note%20that%20some%20authors%20do%20not%20use%20a%20dot%20for%20the%20contraction%20of%20a%20dyad%20with%20a%20vector%20and%20would%20write%20instead%20%24(%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D)%20%5Cmathbf%7Bw%7D%24.%20Since%20we%20use%20the%20%60Dot%2Fdot%60%20in%20Jaxfun%20to%20represent%20the%20contraction%20of%20both%20dyadics%20and%20vectors%2C%20we%20find%20it%20more%20appropriate%20to%20include%20the%20dot%20also%20for%20contraction%20of%20higher%20order%20tensors.%0A%0A%20%20%20%20A%20linear%20combination%20of%20dyads%20is%20called%20a%20dyadic.%20For%20example%20%24%5Cmathbf%7BA%7D%20%3D%202(%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D)%20%2B%203%20(%5Cmathbf%7Bw%7D%20%5Cotimes%20%5Cmathbf%7Bz%7D)%24.%20Note%20that%20even%20though%20a%20dyad%20is%20a%20second%20order%20tensor%2C%20not%20all%20second%20order%20tensors%20are%20dyads.%20That%20is%2C%20we%20cannot%20always%20write%20the%20tensor%20%24%5Cmathbf%7BA%7D%24%20as%20the%20tensor%20product%20of%20two%20vectors%20%24%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D%24.%0A%0A%20%20%20%20The%20contraction%20of%20two%20dyads%20leads%20to%20a%20dyad%0A%0A%20%20%20%20%24%24%0A%20%20%20%20(%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bv%7D)%20%5Ccdot%20(%5Cmathbf%7Bw%7D%20%5Cotimes%20%5Cmathbf%7Bz%7D)%20%3D%20(%5Cmathbf%7Bv%7D%20%5Ccdot%20%5Cmathbf%7Bw%7D)%20(%5Cmathbf%7Bu%7D%20%5Cotimes%20%5Cmathbf%7Bz%7D)%0A%20%20%20%20%24%24%0A%0A%20%20%20%20Let%20create%20some%20dyadics%20in%20Jaxfun%20and%20illustrate.%20First%2C%20the%209%20dyad%20base%20vectors%20can%20be%20obtained%20as%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20display)%3A%0A%20%20%20%20bb%20%3D%20C.base_dyadics()%0A%20%20%20%20display(bb)%0A%20%20%20%20return%20(bb%2C)%0A%0A%0A%40app.cell%0Adef%20_(bb%2C%20display%2C%20r%2C%20theta)%3A%0A%20%20%20%20import%20numpy%20as%20np%0A%0A%20%20%20%20bv%20%3D%20np.array(bb%2C%20dtype%3Dobject).reshape((3%2C%203))%0A%20%20%20%20A%20%3D%202%20*%20bv%5B0%2C%201%5D%20%2B%203%20*%20bv%5B1%2C%202%5D%0A%20%20%20%20B%20%3D%20r%20*%20bv%5B1%2C%201%5D%20%2B%20theta%20*%20bv%5B2%2C%202%5D%0A%20%20%20%20display(A)%0A%20%20%20%20display(B)%0A%20%20%20%20return%20A%2C%20B%2C%20bv%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Contract%20%60A%60%20with%20%60B%60%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(A%2C%20B%2C%20Dot%2C%20display)%3A%0A%20%20%20%20H%20%3D%20Dot(A%2C%20B)%0A%20%20%20%20display(H)%0A%20%20%20%20display(H.doit())%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Operators%20in%20curvilinear%20coordinates%0A%0A%20%20%20%20%23%23%23%20Vector%20operations%0A%0A%20%20%20%20The%20gradient%20of%20a%20scalar%20field%20%24f(%5Cmathbf%7Bx%7D)%24%20is%20termed%20%24%5Ctext%7Bgrad%7D(f)%24%20and%20equals%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%5Ctext%7Bgrad%7D(f)%20%3D%20%5Cnabla%20f%20%3D%20%5Cfrac%7B%5Cpartial%20%7Bf%7D%7D%7B%5Cpartial%20X%5E%7Bi%7D%7D%5C%2C%5Cmathbf%7Bb%7D%5E%7Bi%7D%20%3D%20%5Cfrac%7B%5Cpartial%20%7Bf%7D%7D%7B%5Cpartial%20X%5E%7Bi%7D%7D%20g%5E%7Bij%7D%20%5C%2C%5Cmathbf%7Bb%7D_%7Bj%7D.%20%5Ctag%7B15%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20The%20divergence%20of%20a%20vector%20%24%5Cmathbf%7Bv%7D(%5Cmathbf%7Bx%7D)%24%2C%20in%20terms%20of%20its%20contravariant%20components%2C%20is%20given%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%5Ctext%7Bdiv%7D(%5Cmathbf%7Bv%7D)%20%3D%20%5Cnabla%20%5Ccdot%20%5Cmathbf%7Bv%7D%20%3D%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7Bv%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%5Ccdot%20%5Cmathbf%7Bb%7D%5Ej%20%3D%20%5Cfrac%7B1%7D%7B%5Csqrt%7Bg%7D%7D%20%5Cfrac%7B%5Cpartial%20%7Bv%7D%5E%7Bi%7D%20%5Csqrt%7Bg%7D%7D%7B%5Cpartial%20X%5E%7Bi%7D%7D%2C%5Ctag%7B16%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20and%20the%20Laplacian%20of%20the%20scalar%20field%20%24f%24%20can%20be%20written%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation%7D%0A%20%20%20%20%5Ctext%7Bdiv%7D(%5Ctext%7Bgrad%7D(f))%20%3D%20%5Cnabla%5E2%20f%20%20%3D%20%5Cfrac%7B1%7D%7B%5Csqrt%7Bg%7D%7D%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20X%5E%7Bi%7D%7D%5Cleft(%20g%5E%7Bij%7D%20%5Csqrt%7Bg%7D%20%5Cfrac%7B%5Cpartial%20%7Bf%7D%7D%7B%5Cpartial%20X%5E%7Bj%7D%7D%5Cright).%20%5Ctag%7B17%7D%0A%20%20%20%20%5Cend%7Bequation%7D%0A%0A%20%20%20%20Note%20that%20%24g%5E%7Bij%7D%24%20and%20%24%5Csqrt%7Bg%7D%24%20will%20act%20as%20variable%20coefficients%20when%20the%20operators%20are%20used%20in%20differential%20equations.%0A%0A%20%20%20%20The%20curl%20of%20a%20vector%20is%20defined%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Ctext%7Bcurl%7D(%5Cmathbf%7Bv%7D)%20%3D%20%5Cnabla%20%5Ctimes%20%5Cmathbf%7Bv%7D%20%3D%20%5Cmathbf%7Bb%7D%5E%7Bj%7D%20%5Ctimes%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7Bv%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%3D%20%5Cfrac%7B%5Cvarepsilon_%7Bijk%7D%7D%7B%5Csqrt%7Bg%7D%7D%20%5Cfrac%7B%5Cpartial%20%7Bv%7D_k%7D%7B%5Cpartial%20X%5Ej%7D%20%5Cmathbf%7Bb%7D_i%0A%20%20%20%20%24%24%0A%0A%20%20%20%20The%20partial%20derivative%20%24%5Cfrac%7B%5Cpartial%20%5Cmathbf%7Bv%7D%7D%7B%5Cpartial%20X%5Ej%7D%24%20is%20implemented%20in%20Jaxfun%20as%20the%20%60diff%60%20operator%20working%20on%20vectors.%20The%20partial%20derivative%20can%20be%20computed%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7Bv%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%3D%20%5Cleft(%5Cfrac%7B%5Cpartial%20%7Bv%7D%5E%7Bi%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%2B%20%5CGamma%5E%7Bi%7D_%7Bkj%7D%20%7Bv%7D%5Ek%5Cright)%20%5Cmathbf%7Bb%7D_i%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24%5CGamma%5E%7Bi%7D_%7Bkj%7D%24%20is%20the%20Christoffel%20symbol%20of%20the%20second%20kind%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5CGamma%5E%7Bk%7D_%7Bji%7D%20%3D%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7Bb%7D_%7Bi%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%5Ccdot%20%5Cmathbf%7Bb%7D%5Ek%0A%20%20%20%20%24%24%0A%0A%20%20%20%20available%20in%20Jaxfun%20as%20method%20%60get_christoffel_second%60.%0A%0A%20%20%20%20The%20term%20%24%5Cfrac%7B%5Cpartial%20%7Bv%7D%5E%7Bi%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%2B%20%5CGamma%5E%7Bi%7D_%7Bkj%7D%20%7Bv%7D%5Ek%24%20is%20called%20the%20covariant%20derivative%20of%20vector%20components.%0A%0A%20%20%20%20The%20Christoffel%20symbol%20falls%20out%20of%20the%20last%20identity%20for%20the%20curl%20due%20to%20the%20symmetry%20%24%5CGamma%5E%7Bk%7D_%7Bji%7D%20%3D%20%5CGamma%5Ek_%7Bij%7D%24.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Tensor%20operations%0A%0A%20%20%20%20The%20gradient%20of%20a%20vector%20is%20a%20second%20order%20tensor%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Ctext%7Bgrad%7D(%5Cmathbf%7Bv%7D)%20%3D%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7Bv%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%5Cotimes%20%5Cmathbf%7Bb%7D%5Ej%0A%20%20%20%20%24%24%0A%0A%20%20%20%20Note%20that%20if%20%24%5Cnabla%24%20is%20interpreted%20as%20a%20vector%2C%20then%20this%20corresponds%20to%20%24(%5Cnabla%20%5Cotimes%20%5Cmathbf%7Bv%7D)%5ET%24.%20However%2C%20in%20Jaxfun%20printing%20we%20interpret%20%24%5Cnabla%24%20as%20an%20operator%20and%20as%20such%20%24%5Ctext%7Bgrad%7D(%5Cmathbf%7Bv%7D)%24%20is%20printed%20as%20%24%5Cnabla%20%5Cmathbf%7Bv%7D%24.%0A%0A%20%20%20%20The%20divergence%20of%20a%20second%20order%20tensor%20%24%5Cmathbf%7BA%7D%24%20is%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Ctext%7Bdiv%7D(%5Cmathbf%7BA%7D)%20%3D%20%5Cfrac%7B%5Cpartial%20%5Cmathbf%7BA%7D%7D%7B%5Cpartial%20X%5Ej%7D%20%5Ccdot%20%5Cmathbf%7Bb%7D%5Ej%0A%20%20%20%20%24%24%0A%0A%20%20%20%20Again%2C%20if%20%24%5Cnabla%24%20is%20interpreted%20as%20a%20vector%2C%20then%20%24%5Ctext%7Bdiv%7D(%5Cmathbf%7BA%7D)%20%3D%20%5Cnabla%20%5Ccdot%20%5Cmathbf%7BA%7D%5ET%24.%20But%20in%20Jaxfun's%20printing%20%24%5Cnabla%24%20is%20an%20operator%20acting%20over%20the%20last%20axis%20of%20its%20input%20tensor.%20Hence%20the%20divergence%20of%20a%20tensor%20is%20printed%20as%20%24%5Cnabla%20%5Ccdot%20%5Cmathbf%7BA%7D%24.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20display%2C%20r%2C%20theta)%3A%0A%20%20%20%20from%20jaxfun.operators%20import%20Grad%2C%20Div%0A%0A%20%20%20%20w%20%3D%20r%20*%20C.b_r%20%2B%20theta%20*%20C.b_z%0A%20%20%20%20g%20%3D%20Grad(w)%0A%20%20%20%20display(g)%0A%20%20%20%20display(g.doit())%0A%20%20%20%20return%20Div%2C%20Grad%0A%0A%0A%40app.cell%0Adef%20_(Div%2C%20bv%2C%20display%2C%20r%2C%20z)%3A%0A%20%20%20%20D%20%3D%20r%20*%20bv%5B0%2C%200%5D%20%2B%20z%20*%20bv%5B1%2C%202%5D%0A%20%20%20%20q%20%3D%20Div(D)%0A%20%20%20%20display(q)%0A%20%20%20%20display(q.doit())%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Curvilinear%20equations%0A%0A%20%20%20%20Lets%20consider%20the%20Laplace%20operator%20in%20curvilinear%20coordinates.%20For%20this%20we%20use%20a%20%60ScalarFunction%60%20and%20Jaxfun%20operators%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20Div%2C%20Grad%2C%20display)%3A%0A%20%20%20%20from%20jaxfun.galerkin.arguments%20import%20ScalarFunction%0A%0A%20%20%20%20u_%20%3D%20ScalarFunction(name%3D%22u%22%2C%20system%3DC)%0A%20%20%20%20Lu%20%3D%20Div(Grad(u_))%0A%20%20%20%20display(Lu)%0A%20%20%20%20return%20Lu%2C%20u_%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20Laplace%20operator%20is%20displayed%20in%20Cartesian%20coordinates.%20When%20evaluated%2C%20we%20get%20the%20equation%20in%20cylinder%20coordinates%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Lu%2C%20display)%3A%0A%20%20%20%20display(Lu.doit())%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Note%20the%20map%20from%20Cartesian%20function%20%24u(x%2C%20y%2C%20z)%24%20for%20the%20generic%20(unevaluated)%20operator%20to%20computational%20%24U(r%2C%20%5Ctheta%2C%20z)%24%20in%20the%20evaluated%20equation.%0A%0A%20%20%20%20We%20can%20also%20look%20at%20the%20gradient%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Grad%2C%20display%2C%20u_)%3A%0A%20%20%20%20display(Grad(u_))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Grad%2C%20display%2C%20u_)%3A%0A%20%20%20%20display(Grad(u_).doit())%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Note%20the%20small%20difference%20here%20from%20most%20textbooks%20that%20present%20the%20gradient%20as%20(see%2C%20e.g.%2C%20%5Bwikipedia%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FGradient))%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cnabla%20u%20%3D%20%5Cfrac%7B%5Cpartial%20U%7D%7B%5Cpartial%20r%7D%20%5Chat%7B%5Cmathbf%7Bb%7D%7D_r%20%2B%20%5Cfrac%7B1%7D%7Br%7D%5Cfrac%7B%5Cpartial%20U%7D%7B%5Cpartial%20%5Ctheta%7D%20%5Chat%7B%5Cmathbf%7Bb%7D%7D_%7B%5Ctheta%7D%20%2B%20%5Cfrac%7B%5Cpartial%20U%7D%7B%5Cpartial%20z%7D%5Chat%7B%5Cmathbf%7Bb%7D%7D_z%0A%20%20%20%20%24%24%0A%0A%20%20%20%20using%20normalized%20(unit)%20basis%20vectors%20%24%5Chat%7B%5Cmathbf%7Bb%7D%7D_r%20%3D%20%7B%5Cmathbf%7Bb%7D%7D_r%2C%20%5Chat%7B%5Cmathbf%7Bb%7D%7D_%7B%5Ctheta%7D%20%3D%20%5Cmathbf%7Bb%7D_%7B%5Ctheta%7D%20%2F%20r%24%20and%20%24%5Chat%7B%5Cmathbf%7Bb%7D%7D_z%20%3D%20%5Cmathbf%7Bb%7D_z%24.%20Replacing%20the%20hat%20vectors%20above%20with%20the%20covariant%20basis%20vectors%20leads%20to%20the%20same%20result.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20curl%20of%20a%20gradient%20should%20be%20zero.%20Lets%20verify%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Grad%2C%20display%2C%20u_)%3A%0A%20%20%20%20from%20jaxfun.operators%20import%20Curl%0A%0A%20%20%20%20display(Curl(Grad(u_)))%0A%20%20%20%20return%20(Curl%2C)%0A%0A%0A%40app.cell%0Adef%20_(C%2C%20Curl%2C%20Grad%2C%20display%2C%20u_)%3A%0A%20%20%20%20display(C.simplify(Curl(Grad(u_)).doit()))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%0A%20%20%20%20return%20(mo%2C)%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">0c1dadf2c6afe8d1832a8d956148aa8a</marimo-code-hash>
</body>
</html>
